(function(){"use strict";var n;n=angular.module("pandorabox.pages"),n.register.controller("RLanController",["$scope","$rootScope","$timeout","Status","PBClientList","Fn","FloatDiv","$UCI",function(n,t,e,r,i,a,o,d){var c,l;e(function(){return d.$setAutoSave(!0)},700),i.init(),n.$on("PBClientListUpdate",function(){n.hostList=i.getList({dhcp:!0})}),null==r.ray&&(r.ray={}),n.network=null!=(c=r.ray.network)?c:{},n.dhcp=null!=(l=r.ray.dhcp)?l:{},n.lanRang=null!=r.ray.network?n.network.ipaddr.match(/\d+.\d+.\d+./):"",n.dhcpOption=!0,d.$sync(["network","dhcp","lafite"]).then(function(){var t;n.network=angular.copy(d.network.lan),n.dhcp=angular.copy(d.dhcp.lan),angular.isDefined(n.dhcp.leasetime)&&(t=n.dhcp.leasetime.replace(/(m|h)$/,""),n.dhcp.leasetime=t),n.dhcp.start=+n.dhcp.start,n.dhcp.limit=+n.dhcp.limit,n.dhcp.end=n.dhcp.start+n.dhcp.limit,n.lanRang=d.network.lan.ipaddr.match(/\d+.\d+.\d+./),angular.isUndefined(d.dhcp.lan.ignore)?(n.dhcpOption=!0,n.dhcp.ignore="0"):"1"===d.dhcp.lan.ignore&&(n.dhcpOption=!1)}),n.setLAN=function(){var t,e,r,i;if(null==n.network)return!1;if(null==d.network)return!1;if("0.0.0.0"===n.network.ipaddr)return!1;if("0.0.0.0"===n.network.netmask)return!1;if(!a.isIP(n.network.ipaddr))return!1;if(d.$Native.network.lan.ipaddr===n.network.ipaddr)return!1;t={},r=n.network;for(e in r)i=r[e],d.network.lan[e]!==i&&(t[e]=i);return!(d.$getAutoSave()&&!confirm(a.getTranslate("Machine will be reboot!!! Continue?")))&&(d.$set("network","lan",t),!0)},n.setDHCP=function(){var t,e,r,i,c,l,p,h,u;if(null==n.dhcp)return!1;if(p=n.dhcp.start,e=n.dhcp.end,!(1<p&&p<254))return!1;p<e&&e<254?n.dhcp.limit=e-p:n.dhcp.limit=254-p,t={},l=n.dhcp;for(c in l)u=l[c],/^\./.test(c)||("leasetime"===c&&angular.isString(u)&&(u=+u,u>24?u="24h":0===u?u="1h":u+="h"),"ignore"===c&&(n.dhcpOption?(n.dhcp.ignore=u="0",h="Network will be restart!!! Continue?"):(n.dhcp.ignore=u="1",h="Network will be restart!!! Should Use Static IP!! Continue?")),"end"!==c&&d.dhcp.lan[c]!==""+u&&(t[c]=u));return 0!==Object.keys(t).length&&(d.$getAutoSave()&&Object.keys(t).indexOf("ignore")!==-1&&!confirm(a.getTranslate(h))?(d.$revert("dhcp","lan","ignore"),"1"===d.dhcp.lan.ignore?(n.dhcp.ignore="1",n.dhcpOption=!1):(n.dhcp.ignore="0",n.dhcpOption=!0),!1):(d.$getAutoSave()&&(i=o.once(),r=d.$setEvent("$Native",function(){d.$delEvent(r),i(),n.dhcpOption||(n.hostList=[])})),d.$set("dhcp","lan",t),!0))},t.$on("page.main.current",function(t,e){"rwan"===e&&(r.ray.network=n.network,r.ray.dhcp=n.dhcp)})}])}).call(this);