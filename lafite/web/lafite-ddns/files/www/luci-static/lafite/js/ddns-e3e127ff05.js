(function(){"use strict";var n;n=angular.module("pandorabox.pages"),n.register.controller("DdnsController",["$scope","$rootScope","Status","$UCI","FloatDiv",function(n,e,d,s,t){var a,i,r,l,u,o,c;null==d.ddns&&(d.ddns={}),i="",r="",l=!1,a={},n.ddnsSwitch=!1,n.myddns=null!=(u=d.ddns.myddns)?u:{},n.service_list=null!=(o=d.ddns.service_list)?o:[],s.$sync(["ddns"]).then(function(){var e,d;a=angular.copy(s.ddns);for(d in a)e=a[d],"service"===e[".type"]&&(/ipv6/.test(d)?(r=d,l=!0):(i=d,n.myddns=e,angular.isUndefined(n.myddns.enabled)?n.myddns.enabled="0":"1"===n.myddns.enabled&&(n.ddnsSwitch=!0)))}),c="GET cat /usr/lib/ddns/services",s.$command(c,"now").then(function(e){var d,s,t;"ok"===e.status&&angular.isArray(e.commands)&&e.commands[0].command===c&&(e=e.commands[0].content,n.service_list=function(){var n,a,i,r,l;for(l=[],n=0,i=e.length;n<i;n++)s=e[n],/^"(\S+)"\s+"(\S+)"/.test(s)&&(r=s.match(/^"(\S+)"\s+"(\S+)"/),a=r.length-2,t=r[a++],d=r[a++],l.push({ipv4_url:t,ipv6_url:d}));return l}())}),n.submit=function(e){var d,a,u,o,c,v,m,f,p,g,_,b;if(angular.isUndefined(n[e]))return!1;s.$revert("ddns"),s.$setFlag("ddns"),u=t.once(),a=s.$getAutoSave(),s.$setAutoSave(!1),g=function(){s.$setAutoSave(a),s.$save("ddns"),u()},d={},n.ddnsSwitch?n.myddns.enabled="1":n.myddns.enabled="0",f=n[e];for(v in f)b=f[v],s.ddns[i][v]!==b&&(d[v]=b);if(null!=d.domain&&(d.lookup_host=d.domain),angular.isDefined(d.enabled)&&"0"===d.enabled&&(d={enabled:"0"}),s.$set("ddns",i,d),!l)return g(),!0;if(_=d.service_name,angular.isDefined(_))for(p=n.service_list,o=0,m=p.length;o<m;o++)if(c=p[o],c.ipv4_url===_){s.ddns[r].ipv6_url!==c.ipv6_url&&(d.update_url=c.ipv6_url),delete d.service_name;break}return angular.isDefined(d.enabled)&&delete d.enabled,s.$set("ddns",r,d),g(),!0},e.$on("page.main.current",function(e,s){"ddns"===s&&(d.ddns.myddns=n.myddns,d.ddns.service_list=n.service_list)})}])}).call(this);