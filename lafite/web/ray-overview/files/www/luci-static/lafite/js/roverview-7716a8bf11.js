(function(){"use strict";var n;n=angular.module("pandorabox.pages"),n.register.controller("ROverviewController",["$scope","$interval","$filter","$q","$timeout","PBClientList","PBBandwidth","$UCI","Fn","Status",function(n,e,t,a,r,o,i,l,s,u){var d,c,f,h,g;n.Status=u,d=!1,n.lanClientList=[],n.wifiClientList=[],o.init(),(c=function(){var e,t,a,r,i,l,s,d,c,f,h,g,v,p,m,w,B,b,I,x,$,U;for(c=o.getList({dhcp:!0,port:!0}),c=function(){var n,e,t,a;for(a=[],n=0,e=c.length;n<e;n++)i=c[n],i.siteIndex=(null!=(t=u.board.lanRole)?t:[]).indexOf(i.portIndex),a.push(i);return a}(),p=[{oldFlag:"lanClientList",newList:c},{oldFlag:"wifiClientList",newList:o.getList({dhcp:!0,wireless:!0})}],t=function(n,e){var t,a,r,o,i,l,s;for(a=t=0,o=n.length;t<o;a=++t){l=n[a],i=e[a];for(r in i)s=i[r],l[r]=s}return n},U=function(n,e){var t,a,r,o,l,s,u,d,c,f,h,g,v,p,m,w,B,b;for(a=[],w=o=0,f=n.length;o<f;w=++o){for(B=n[w],s=!1,r=function(n,e){var t,a,r;a=[];for(t in e)r=e[t],a.push(n[t]=r);return a},u=0,h=e.length;u<h;u++)p=e[u],B.macaddr===p.macaddr&&(s=!0,r(B,p));s||a.push(w)}for(d=a.length-1;d>=0;d+=-1)t=a[d],n.splice(t,1);if(n.length!==e.length)for(b=function(){var e,t,a;for(a=[],e=0,t=n.length;e<t;e++)i=n[e],a.push(i.macaddr);return a}(),m=function(){var n,t,a;for(a=[],n=0,t=e.length;n<t;n++)i=e[n],a.push(i.macaddr);return a}(),l=c=0,g=m.length;c<g;l=++c)v=m[l],-1===b.indexOf(v)&&n.push(e[l]);return n},a=0,f=p.length;a<f;a++)if(b=p[a],I=b.oldFlag,x=function(){var e,t,a,r;for(a=n[I],r=[],e=0,t=a.length;e<t;e++)i=a[e],null!=(null!=i?i.macaddr:void 0)&&r.push(i);return r}(),w=b.newList,0===x.length?x=w:($=function(){var n,e,t;for(t=[],n=0,e=x.length;n<e;n++)i=x[n],t.push(i.macaddr);return t}().join(""),B=function(){var n,e,t;for(t=[],n=0,e=w.length;n<e;n++)i=w[n],t.push(i.macaddr);return t}().join(""),x=$===B?t(x,w):U(x,w)),/lan/.test(I)){for(m=0,l=0,h=x.length;l<h;l++)i=x[l],i.siteIndex>m&&(m=i.siteIndex);for(e=new Array(m),r=s=0,g=e.length;s<g;r=++s)i=e[r],e[r]={siteIndex:r};for(d=0,v=x.length;d<v;d++)i=x[d],e[i.siteIndex]=i;n[I]=e}else n[I]=x})(),n.$on("PBClientListUpdate",function(){d||c()}),i.init(),n.$on("PBBandwidthUpdate",function(){var e;e=i.getInfo(),n.wanInfo.upload=g(e.global.upload),n.wanInfo.download=g(e.global.download),n.wanInfo.up=0!==e.global.update||0!==e.global.download}),n.editClientName=function(n){return d=!0,n.flags.edit=!0,function(n){return r(function(){return document.getElementsByName("client_"+n.macaddr)[0].focus()},200)}(n),!0},n.setClientName=function(n){return o.setClientName(n.macaddr,n.hostname)["finally"](function(){d=!1,n.flags.edit=!1,c()})},g=function(n){var e,t;switch(null==n&&(n=0),t="B",n=+n,t=n>=1099511627776?"TB":n>=1073741824?"GB":n>=1024576?"MB":n>=1024?"KB":"B"){case"B":e=n.toFixed(2);break;case"KB":e=(n/1024).toFixed(2);break;case"MB":e=(n/1024576).toFixed(2);break;case"GB":e=(n/1073741824).toFixed(2);break;case"TB":e=(n/1099511627776).toFixed(2)}return e+" "+t},n.wanInfo={up:!1,upload:"0.0 B",download:"0.0 B",lastUpdateTime:0},n.hasUsbDev=!1,h="",n.storageInfo={totalUsed:"",totalSize:""},(f=function(){var e,t,r;return e=0,t=!1,r=function(e){var t,r,o,i,l,s,u;for(s=0,u=0,l=e.content,r=0,i=l.length;r<i;r++)o=l[r],/^(Totalsize|Used)/.test(o)&&(/^Totalsize/.test(o)?s=+o.replace(/\D/g,""):/^Used/.test(o)&&(t=+o.replace(/\D/g,""),u+=t));return 0===s&&(n.hasUsbDev=!1),n.storageInfo.totalUsed=g(u),n.storageInfo.totalSize=g(s),a.resolve(n.storageInfo)},function(){var o,i,s;return t?a.reject("Getting"):(t=!0,s=a.resolve(),0===e&&(s=l.$sync(["samba"]).then(function(){var e,t,a;return a=function(){var n,a;n=l.$Native.samba,a=[];for(e in n)t=n[e],null!=t.device&&a.push(t);return a}(),0!==a.length?(n.hasUsbDev=!0,h=a[0].device.replace(/\d*$/,"")):(n.hasUsbDev=!1,h="")})),o=[],1===e&&0!==h.length&&o.push("GET usb_device_info /dev/"+h),i=0!==o.length?l.$command(o,"now").then(function(n){var e,t,o;return e=0,o=function(){var e,a,o,i;for(o=n.commands,i=[],e=0,a=o.length;e<a;e++)switch(t=o[e],!1){case!/\susb_device_info\s/.test(t.command):i.push(r(t));break;default:continue}return i}(),a.all(o)}):a.resolve(),a.all([s,i])["finally"](function(){t=!1,3!==e?e++:e=0}))}}())(),function(){var t;t=e(f,2800),n.$on("page.main.current",function(){e.cancel(t)})}()}])}).call(this);