(function(){"use strict";var n;n=angular.module("pandorabox.pages"),n.register.controller("RNetworkStatusController",["$scope","$rootScope","$timeout","$interval","Status","$UCI",function(n,t,a,e,r,o){var l,u,i,d,s,c,h,f,g,p,x,m,y,v,w,b,k,T,L,M,P,j,S;null==r.ray&&(r.ray={}),c=null!=(m=r.ray.bandwidthList)?m:[],b=null!=(y=r.ray.speedList)?y:[],n.speedObj=k=null!=(v=r.ray.speedObj)?v:{curUpload:"Loading..",curDownload:"Loading..",maxUpload:"Loading..",maxDownload:"Loading..",avgUpload:"Loading..",avgDownload:"Loading.."},T=function(n,t){var a;switch(null==t&&(t="object"),a="B/s",n=+n,angular.isNumber(n)||(n=0),n<0&&(n=0),!0){case 0<=n&&n<1024:a="B/s";break;case 1024<=n&&n<1048576:n/=1024,a="KB/s";break;case 1048576<=n&&n<1073741824:n/=1048576,a="MB/s";break;case 1073741824<=n:n/=1073741824,a="GB/s";break;case 1099511627776<=n:n/=1099511627776,a="TB/s"}switch(n=n.toFixed(1),!1){case"object"!==t:return{value:+n,unit:a};case"string"!==t:return n+" "+a;default:return{value:+n,unit:a}}},M=function(n){var t,a,e;if("ok"===n.status){if(n=n.commands,c.length>60&&c.shift(),0===n[0].content.length)return void c.push({download:0,upload:0,date:+n[1].content.join(""),list:[]});a=function(){var a,r,o,l;for(o=n[0].content,l=[],a=0,r=o.length;a<r;a++)t=o[a],e=t.split(/[\s,]+/),l.push({ipaddr:e[0],macaddr:e[1],download:+e[2],upload:+e[3]});return l}(),c.push({upload:+a.reduce(function(n,t){return n+t.upload},0),download:+a.reduce(function(n,t){return n+t.download},0),date:+n[1].content.join(""),list:a})}},S=function(){var n,t,a,e,r,o;c.length<2||(t=function(n,t){var a;return a=c,a[t][n]-a[t-1][n]},b=function(){var l,u,i;for(i=[],e=l=0,u=c.length;l<u;e=++l)r=c[e],0!==e&&(n=function(n){return t(n,e)},0!==n("date")&&(o=n("upload")/n("date"),a=n("download")/n("date"),i.push({upload:+o.toFixed(2),download:+a.toFixed(2)})));return i}())},j=function(){var n,t;c.length<2||(k.curUpload=T(b[b.length-1].upload,"string"),k.curDownload=T(b[b.length-1].download,"string"),k.maxUpload=T(Math.max.apply(this,function(){var n,a,e;for(e=[],n=0,a=b.length;n<a;n++)t=b[n],e.push(t.upload);return e}()),"string"),k.maxDownload=T(Math.max.apply(this,function(){var n,a,e;for(e=[],n=0,a=b.length;n<a;n++)t=b[n],e.push(t.download);return e}()),"string"),n=function(n){var t,a,e,r;if(e=0,null==n||0===n.length)return e;for(t=0,a=n.length;t<a;t++)r=n[t],0!==r&&(e+=r/n.length);return e.toFixed(2)},k.avgUpload=T(n(function(){var n,a,e;for(e=[],n=0,a=b.length;n<a;n++)t=b[n],e.push(t.upload);return e}()),"string"),k.avgDownload=T(n(function(){var n,a,e;for(e=[],n=0,a=b.length;n<a;n++)t=b[n],e.push(t.download);return e}()),"string"))},s=20,l=400,u=800,i=380,d=720,P=function(){var n,t,a,e,r,o,c,p,m,y,v,w,k,T,L;for(w=[],0===b.length?w.push({upload:0,download:0}):w=b.slice(0-s);w.length!==s;)w.unshift(w[0]);L=Math.max.apply(this,function(){var n,t,a;for(a=[],n=0,t=w.length;n<t;n++)y=w[n],a.push(y.upload);return a}()),c=Math.max.apply(this,function(){var n,t,a;for(a=[],n=0,t=w.length;n<t;n++)y=w[n],a.push(y.download);return a}()),k={max:L>c?L:c,min:0},k.max=function(){var n,e,r;switch(!1){case!(0<=(n=k.max)&&n<1024):return a=16,k.max+a>=1024?k.max=1024:k.max<a?k.max=a:k.max+=a;case!(1024<=(e=k.max)&&e<1048576):return a=2048,k.max+a>=1048576?k.max=1048576:k.max<a?k.max=a:k.max+=a;case!(1048576<=(r=k.max)&&r<1073741824):return t=2097152,k.max+t>=1073741824?k.max=1073741824:k.max<a?k.max=a:k.max+=t;case!(1073741824<=k.max):return k.max+=107374182}}(),T=u-d,p=function(n){var t;return t=d/(s-1)*n+T,Math.floor(t)},v=[],v.length=s,v=function(){var t,a,e;for(e=[],m=t=0,a=v.length;t<a;m=++t)n=v[m],e.push(p(m));return e}(),r=function(){var n,t,a;for(a=[],m=n=0,t=w.length;n<t;m=++n)y=w[m],a.push({x:v[m],y:Math.floor((1-y.upload/k.max)*i)});return a}(),e=function(){var n,t,a;for(a=[],m=n=0,t=w.length;n<t;m=++n)y=w[m],a.push({x:v[m],y:Math.floor((1-y.download/k.max)*i)});return a}(),o=document.getElementById("canvas"),null!=o&&(o=o.getContext("2d"),o.clearRect(0,0,u,l),o.beginPath(),o.fillStyle="rgb(220, 232, 237)",o.fillRect(T,0,d-2,i+2),o.closePath(),h(o),f(o,k),o.lineWidth=2,x(o,r),g(o,e),o.restore())},h=function(n){var t,a,e,r,o,l,s,c,h;for(n.beginPath(),n.strokeStyle="#5d76db",n.lineWidth=3,n.moveTo(u-d,0),n.lineTo(u-d,i+2),n.lineTo(u,i+2),n.stroke(),n.closePath(),n.beginPath(),n.strokeStyle="#5d74da",n.lineWidth=1,e=function(t,a,e,r){var o,l,u,i,d,s,c,h,f,g,p;for(s=5,g=e-t,p=r-a,c=Math.floor(Math.sqrt(g*g+p*p)/s),h=new Array(c),f=[],i=u=0,d=h.length;u<d;i=++u)o=h[i],l={x:t+g/c*i,y:a+p/c*i},i%2===0?f.push(n.moveTo(l.x,l.y)):f.push(n.lineTo(l.x,l.y));return f},c=a=new Array(5),l=o=0,s=c.length;o<s;l=++o)t=c[l],r=i/a.length*l,h=u-d,e(h,r+1,u,r+1);n.stroke(),n.closePath()},f=function(n,t){var a,e,r,o,l,u,d,s,c;for(n.beginPath(),n.fillStyle="#5d74da",u=r=new Array(5),l=o=u.length-1;o>=0;l=o+=-1)a=u[l],e=l+1,s=(t.max-t.min)/r.length*e,d=T(+s.toFixed(2),"string"),c=i/r.length*(r.length-e),n.fillText(d,0,c+10);n.closePath()},p=function(n,t,a){var e,r,o,l,u,s,c;for(null==a&&(a="#fff"),n.beginPath(),n.strokeStyle=a,l=o=0,u=t.length;o<u;l=++o)s=t[l],e={x:s.x,y:s.y>i?d:s.y},0!==l&&(c=angular.copy(t[l-1]),c.y=c.y>i?d:c.y),0===l?n.moveTo(e.x,e.y):e.y===c.y?n.lineTo(e.x,e.y):(r={x1:(s.x+c.x)/2,y1:c.y,x2:(s.x+c.x)/2,y2:e.y},n.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,s.x,e.y));n.stroke(),n.closePath()},x=function(n,t){return p(n,t,"#1caae8")},g=function(n,t){return p(n,t,"#f95b8b")},(w=function(){var n;if(!n)return P(),n=!0,o.$command(["GET cat /proc/bandwidth","GET date +%s"],"now").then(function(t){return n=!1,t}).then(M).then(S).then(j).then(P)})(),a(w,1e3),L=e(function(){var n,a;return null!=(null!=(n=t.page)&&null!=(a=n.main)?a.current:void 0)&&"rnetstus"!==t.page.main.current?void e.cancel(L):w()},3e3),t.$on("page.main.current",function(t,a){"rnetstus"===a&&(e.cancel(L),r.ray.bandwidthList=c,r.ray.speedList=b,r.ray.speedObj=n.speedObj)})}])}).call(this);