(function(){"use strict";var n;n=angular.module("pandorabox.pages"),n.register.controller("ClientListController",["$scope","$UCI","Status","$q","$filter",function(n,t,e,r,s){var l,i,o,a,c,u,d,f,h,m,p,w,g;null==e.client&&(e.client={}),o="/tmp/dhcp.leases",l=[],n.whitelist=null!=(h=e.client.whitelist)?h:[],n.blacklist=null!=(m=e.client.blacklist)?m:[],n.showlist="white",g=[],i=[],w=function(){var n;return 0===l.length?r.reject():(n=l.map(function(n){return"GET iwinfo "+n+" assoclist"}),n=n.concat(["GET cat "+o,"GET date +'%s'"]),t.$command(n,"now"))},a=function(n){var t,e,r,l,o,a,c,u,d,f,h;for(i=[],t=0,d=n.commands,e=0,o=d.length;e<o;e++)c=d[e],/^GET date/.test(c.command)&&(t=+(""+c.content[0]));for(f=n.commands,h=[],l=0,a=f.length;l<a;l++)c=f[l],/^GET cat/.test(c.command)&&h.push(i=function(){var n,e,l,i,o,a,d;for(l=c.content,d=[],n=0,e=l.length;n<e;n++)r=l[n],u=r.match(/^(\d+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)/),u[1]=s("date")(1e3*(+u[1]-t),"HH:mm:ss","+0000"),d.push({expires:u[1],macaddr:null!=(i=u[2].toUpperCase())?i:"00:00:00:00:00:00",ipaddr:null!=(o=u[3])?o:"255.255.255.255",hostname:null!=(a=u[4])?a:"unknown",duid:u[5]});return d}());return h},d=function(n){var t,e,r,s,l,i,o,a;for(g=[],o=n.commands,a=[],e=0,s=o.length;e<s;e++)l=o[e],/^GET iwinfo/.test(l.command)&&1!==l.content.length&&a.push(function(){var n,e,s,o,a,c,u,d;for(s=l.content,d=[],r=n=0,e=s.length;n<e;r=++n)t=s[r],/^(\w{2}:){5}\w{2}/.test(t)&&(i=t.match(/^((?:[\da-f]{2}:){5}[\da-f]{2}).*?(\d+)\s+ms\s+ago/i),d.push(g.push({macaddr:null!=(o=i[1].toUpperCase())?o:"00:00:00:00:00:00",time:null!=(a=i[2])?a:"0",rx:null!=(c=l.content[r+1].match(/rx:\s+(\d+.*?\/s)/i)[1])?c:"unknown",tx:null!=(u=l.content[r+2].match(/tx:\s+(\d+.*?\/s)/i)[1])?u:"unknown"})));return d}());return a},f=function(){var t,r,s,l,o,a,c,u,d;for(u={},r=0,a=g.length;r<a;r++)s=g[r],u[s.macaddr]=s;for(l=0,c=i.length;l<c;l++)if(s=i[l],null!=u[s.macaddr])for(o in s)d=s[o],u[s.macaddr][o]=d;else u[s.macaddr]=s;for(t in u)s=u[t],null==s.expires&&(s.expires=-1);return n.whitelist=function(){var n;n=[];for(t in u)s=u[t],n.push(s);return n}(),e.client.whitelist=n.whitelist},p=n.refresh=function(){return u(),c(),w().then(function(n){return d(n),a(n)}).then(function(){return f()})},u=function(){var n;l=function(){var e;e=[];for(n in t.wireless)/^cfg/.test(n)||e.push(n);return e}()},c=function(){var n,e,r,s;r=t.dhcp,s=[];for(n in r)e=r[n],"dnsmasq"===e[".type"]&&s.push(o=e.leasefile);return s},null==t.wireless?t.$sync(["wireless","dhcp"]).then(function(){return p()}):p()}])}).call(this);