(function(){"use strict";var n;n=angular.module("pandorabox.pages"),n.register.service("PBBandwidth",["$rootScope","$q","$interval","Fn","$UCI",function(n,t,a,r,e){var o,l,u,i,d,c,s,p,f,h,w,m;return d=!1,m=null,p={},o={},c=0,this.init=function(){return d?f():i().then(function(){return d=!0}).then(f)},this.getConfig=function(){return{isInit:d,leaseUpadteDate:c}},u=this.getList=function(){var n,t;return function(){var a;a=[];for(n in p)t=p[n],a.push({ipaddr:t.ipaddr,macaddr:t.macaddr,upload:t.upload,download:t.download,isLimit:t.isLimit});return a}()},this.getInfo=function(){var n,t,a;return n={clients:null!=(t=u())?t:[],global:{leaseUpadteDate:c}},a=function(n){var t,a,r,e,o;for(o=0,e=0,a=0,r=n.length;a<r;a++)t=n[a],o+=t.upload,e+=t.download;return[o,e]}(n.clients),n.global.upload=a[0],n.global.download=a[1],n},i=function(){return d=!0,t.resolve()},s=function(n,a){var r,e,l,u,i,d,s,f,h,w,m,v,g,b,U,$,j;for(null==a&&(a=0),m={},e=angular.copy(p),u=+a-c,u<0&&(u=0),v=n.content,f=0,w=v.length;f<w;f++)h=v[f],d=h.split(/[\s,]+/),d[1]=d[1].toUpperCase(),l={ipaddr:d[0],macaddr:d[1],rawUpload:+d[2],rawDownload:+d[3],isLimit:"1"===d[4]},s=l.rawDownload,j=l.rawUpload,0!==u&&(r=null!=(g=null!=(b=e[l.macaddr])?b.rawDownload:void 0)?g:0,s=s===r||0===r?0:(s-r)/u,i=null!=(U=null!=($=e[l.macaddr])?$.rawUpload:void 0)?U:0,j=j===i||0===i?0:(j-i)/u),l.upload=+j.toFixed(2),l.download=+s.toFixed(2),m[l.macaddr]=l;return o=angular.copy(p),p=angular.copy(m),c=a,t.resolve()},w=function(){var r,o;return null!=m?t.reject():(r=["GET date +'%s'","GET cat /proc/bandwidth"],o=function(){return e.$command(r,"now").then(function(n){var a,r,e;return"ok"!==n.status?t.reject():(e=function(){var e,o,l,u;for(l=n.commands,u=[],e=0,o=l.length;e<o;e++)switch(r=l[e],!1){case!/\sdate\s/.test(r.command):a=+r.content[0],u.push(t.resolve(a));break;case!/bandwidth$/.test(r.command):u.push(s(r,a));break;default:continue}return u}(),t.all(null!=e?e:[]))}).then(function(){return n.$broadcast("PBBandwidthUpdate",!0)})},m=a(o,3e3),t.all([o(),m]))},f=this.start=function(){return d?null!=m?t.reject():w():t.reject()},h=this.stop=function(){return null==m?t.reject():(a.cancel(m),m=null,t.resolve())},l=this.clear=function(){return p={},o={},t.resolve()},n.$on("page.main.current",function(){h()}),this}])}).call(this),function(){"use strict";var n;n=angular.module("pandorabox.pages"),n.register.service("PBBandwidth",["$rootScope","$q","$interval","Fn","$UCI",function(n,t,a,r,e){var o,l,u,i,d,c,s,p,f,h,w,m;return d=!1,m=null,p={},o={},c=0,this.init=function(){return d?f():i().then(function(){return d=!0}).then(f)},this.getConfig=function(){return{isInit:d,leaseUpadteDate:c}},u=this.getList=function(){var n,t;return function(){var a;a=[];for(n in p)t=p[n],a.push({ipaddr:t.ipaddr,macaddr:t.macaddr,upload:t.upload,download:t.download,isLimit:t.isLimit});return a}()},this.getInfo=function(){var n,t,a;return n={clients:null!=(t=u())?t:[],global:{leaseUpadteDate:c}},a=function(n){var t,a,r,e,o;for(o=0,e=0,a=0,r=n.length;a<r;a++)t=n[a],o+=t.upload,e+=t.download;return[o,e]}(n.clients),n.global.upload=a[0],n.global.download=a[1],n},i=function(){return d=!0,t.resolve()},s=function(n,a){var r,e,l,u,i,d,s,f,h,w,m,v,g,b,U,$,j;for(null==a&&(a=0),m={},e=angular.copy(p),u=+a-c,u<0&&(u=0),v=n.content,f=0,w=v.length;f<w;f++)h=v[f],d=h.split(/[\s,]+/),d[1]=d[1].toUpperCase(),l={ipaddr:d[0],macaddr:d[1],rawUpload:+d[2],rawDownload:+d[3],isLimit:"1"===d[4]},s=l.rawDownload,j=l.rawUpload,0!==u&&(r=null!=(g=null!=(b=e[l.macaddr])?b.rawDownload:void 0)?g:0,s=s===r||0===r?0:(s-r)/u,i=null!=(U=null!=($=e[l.macaddr])?$.rawUpload:void 0)?U:0,j=j===i||0===i?0:(j-i)/u),l.upload=+j.toFixed(2),l.download=+s.toFixed(2),m[l.macaddr]=l;return o=angular.copy(p),p=angular.copy(m),c=a,t.resolve()},w=function(){var r,o;return null!=m?t.reject():(r=["GET date +'%s'","GET cat /proc/bandwidth"],o=function(){return e.$command(r,"now").then(function(n){var a,r,e;return"ok"!==n.status?t.reject():(e=function(){var e,o,l,u;for(l=n.commands,u=[],e=0,o=l.length;e<o;e++)switch(r=l[e],!1){case!/\sdate\s/.test(r.command):a=+r.content[0],u.push(t.resolve(a));break;case!/bandwidth$/.test(r.command):u.push(s(r,a));break;default:continue}return u}(),t.all(null!=e?e:[]))}).then(function(){return n.$broadcast("PBBandwidthUpdate",!0)})},m=a(o,3e3),t.all([o(),m]))},f=this.start=function(){return d?null!=m?t.reject():w():t.reject()},h=this.stop=function(){return null==m?t.reject():(a.cancel(m),m=null,t.resolve())},l=this.clear=function(){return p={},o={},t.resolve()},n.$on("page.main.current",function(){h()}),this}])}.call(this);