(function(){"use strict";angular.module("pbApp").controller("MainController",["$scope","$rootScope","$location","Data","BrowserModel","ThemeVersion",function(e,n,t,a,o,i){var r,s,l;e.browserModel=function(){var e;e=[];for(r in o)l=o[r],l===!0&&e.push(r);return e}().join(" "),a.isMobile=null!=(s=o.mobile)&&s,n.showMe=!1,n.headerShow=!1,e.themeVersion=i.version,n.$on("$viewContentLoaded",function(){var e;e=t.path(),/menu/.test(e)?n.logoStyle="big":n.logoStyle="",/login/.test(e)||/guide/.test(e)?n.headerShow=!1:n.headerShow=!0,/login/.test(e)||/menu/.test(e)||/guide/.test(e)?n.navShow=!1:n.navShow=!0})}])}).call(this),function(){"use strict";angular.module("pbApp").controller("AboutController",["$scope","Fn","$sce","Data",function(e,n,t,a){"zh_cn"===a.sys.lang?(e.firmware=t.trustAsHtml('PandoraBox路由器系统是基于OpenWrt二次开发的路由器系统，它的目标在于为智能设备厂商和开发者提供具有高可靠性和稳定性的完整解决方案。\n<br/>\n<br/>全新的网页框架和丰富的插件支持是这款系统的特性，简单易用的引导系统能使你的设备轻松地享有与以往不一样的操控体验，尤其适合智能路由器。\n<br/>\n<br/>相比原版的OpenWrt系统，PandoraBox有以下特性:\n<br/>\n<br/>1.简单易用的操作页面和OpenWrt原生的管理界面\n<br/>\n<br/>2.经过测试的闭源厂商驱动，解决OpenWrt最大的缺陷\n<br/>\n<br/>3.实时linux内核, 增强保证系统的稳定性以及响应速度\n<br/>\n<br/>4.独有的NAS应用加速，提升50%的文件传输性能\n<br/>\n<br/>5.完善OpenWrt驱动API层兼容\n<br/>\n<br/>6.Codec/VoIP/VoiceDSP互联网通信套件支持\n<br/>\n<br/>7.智能网络带宽控制支持\n<br/>\n<br/>PS.附带的Bootloader 支持路由器故障恢复模式等增强功能\n<br/>\n<br/>\n<br/>\n<br/>PandoraBox是一套完整的路由器系统解决方案,由PandoraBox团队开发和维护，坚持每周迭代。\n<br/>\n<br/>BUG报告:<a href="http://bug.pandorabox.org.cn">http://bug.pandorabox.org.cn</a>\n<br/>\n<br/>'),e.team=t.trustAsHtml("<br/>PandoraBox团队是由开源DreamBox项目组成员lintel创立，专注于提供消费类网络设备的系统解决方案。\n<br/>\n<br/>目前团队规模为15位左右，主要集中于OpenWrt相关研发，如BSP软件硬件支持，Linux网络增强，DPI引擎等。\n<br/>\n<br/>商务合作:\n<br/>\n<br/>ray@xcloud.cc\n<br/>\n<br/>D-Team Technology Co.,Ltd. ShenZhen(PandoraBox Team)\n<br/>\n<br/>地址：深圳市南山区科技园南区高新南四道W1-A幢6层612\n<br/>\n<br/>")):e.firmware=t.trustAsHtml("PandoraBox is a router system, which is developing on the basic of OpenWRT.It is aim to provide reliable and stable solutions to the intelligent devices' factory and developers.\n<br/>\n<br/>New UI and abundant plugins supports are the characters of this system.\nThe easy-to-use setup wizard can makes users easy to enjoy a different operating experience, especially for the smart routers.\n<br/>\n<br/>Compare to the original OpenWRT system, PandoraBox has the below features:\n<br/>\n<br/>1.With easy-to-use wizard interface and Original OpenWRT management interface.\n<br/>\n<br/>2.Tested closed source vendor-driven, solves the biggest defect of OpenWRT.\n<br/>\n<br/>3.Real-time Linux Kernel, enhance and ensure the stability and response speed.\n<br/>\n<br/>4.Unique NAS application accelerator, increased 50% files transmission performance.\n<br/>\n<br/>5.Full support API of OpenWRT driven.\n<br/>\n<br/>6.Support Codec/VoIP/VoiceDSP, Internet communication suites.\n<br/>\n<br/>7.Support Intelligent bandwidth control.\n<br/>\n<br/>Ps. The additional Bootloader can supports certain enhancements as the routers' failure-recovery mode.\n<br/>\n<br/>PandoraBox is a full set of routers' system solution, which is develop and maintain by PandoraBox Team, keep iterating every week.\n<br/>\n<br/>BUG report to: http://bug.pandorabox.org.cn\n<br/>")}])}.call(this),function(){"use strict";angular.module("pbApp").controller("ExitController",["$scope","$location","Data",function(e,n,t){return t.user={},t.preSite=null,window.localStorage.setItem("pb.startTime",-3600),window.localStorage.setItem("pb.user",null),n.path("/login")}])}.call(this),function(){"use strict";angular.module("pbApp").controller("GuideController",["$scope","$http","$location","$interval","$timeout","$route","$sce","$translate","Data","Fn","Toast","Dialog","BrowserModel",function(e,n,t,a,o,i,r,s,l,c,u,d,p){var f,g,m,w,h,v,y,_,b,k,S,x,L,D,A,P,T,C,N;c.partialLoadLang(["guide","wan","wifi"]),h=!1,v=!1,w={thanks:"/luci-static/lafite/htm/guide_thanks.htm",languages:"/luci-static/lafite/htm/guide_languages.htm",pwd:"/luci-static/lafite/htm/guide_pwd.htm",wan:"/luci-static/lafite/htm/guide_wan.htm",wifi:"/luci-static/lafite/htm/guide_wifi.htm",agreement:"/luci-static/lafite/htm/guide_agreement.htm"},D=["languages","guide_new_pwd","wan_info"],g=[],_="",S="admin",e.sync={synctext:"guide_diff",syncWifiPwd:"0"},e.syncOption=[{key:"guide_diff",value:"0"},{key:"guide_same",value:"1"}],e.template={url:w.languages},e.wifi_conf={mode:"easy",base:0,advance:0,single:!1,base_ssid:"",base_pwd:"",adv24_ssid:"",adv24_pwd:"",adv58_ssid:"",adv58_pwd:"",device_24:"",device_58:""},e.wan_conf={proto:"dhcp",pppoe:{uname:"",pwd:""},"static":{ipaddr:"",netmask:"",gateway:""}},e.languages=c.langlist,e.langOptions_text=l.sys.lang,e.$watch("wifi_conf.base_ssid",function(n){angular.isString(n)&&n.length>0&&(e.wifi_conf.adv24_ssid=n,e.wifi_conf.adv58_ssid=n+"_5G")}),e.$watch("wifi_conf.base_pwd",function(n){angular.isString(n)&&n.length>0&&(e.wifi_conf.adv24_pwd=n,e.wifi_conf.adv58_pwd=n)}),e.guide=function(n){switch(n){case"skip":x();break;case"languages":e.template.url=w.languages;break;case"thanks":y()&&(e.template.url=w.thanks);break;case"pwd":e.template.url=w.pwd;break;case"wan":k()&&(e.template.url=w.wan,d.text("detectWAN"),T());break;case"wifi":(A()||P()||C())&&(e.template.url=w.wifi);break;case"agreement":N()&&(e.template.url=w.agreement);break;case"conf":g.push({reboot:"/cgi-bin/luci/api/guide/finish"}),o(function(){f()},1e3)}},e.showLang=function(n){!angular.isUndefined(n)&&angular.isString(n)&&""!==n&&("auto"===n?(_=(navigator.language||navigator.userLanguage).toLowerCase().replace("-","_"),e.langOptions_text=_):(e.langOptions_text=n,_=n),c.langlist.indexOf(_)===-1&&(_="en_us"),l.sys.lang=_,s.use(l.sys.lang),o(function(){e.guide("thanks")},100))},e.changeSync=function(n){angular.isDefined(n)&&(e.sync.syncWifiPwd=n.value,e.sync.synctext=n.key)},L=function(n){var t;if(angular.isDefined(n)&&"1"===n){if(t=e.guide.newPwd,!c.checkParameter(t,{minLen:8}))return u.warn("warn_syncpwd"),!1;e.wifi_conf.base_pwd=t,e.wifi_conf.adv24_pwd=t,e.wifi_conf.adv58_pwd=t}return!0},x=function(){var e;e=function(n){c.postJSON("/cgi-bin/luci/api/guide/skip",function(t){return 0!==t.code?void(n++<3&&e(n)):(t=t.content[0],void(angular.isDefined(t.isGuide)&&(l.sys.guide=t.isGuide,b(!0))))},function(){return n++>=3?(u.warn("Network_Timeout!"),void setTimeout(function(){u.warn("PlsCheckPing")},1500)):void e(n)})},c.getTranslate("guide_skip",function(n){confirm(n+"?")&&(d.text(n+"..."),e(0))})},e.flag=!0,e.showLicense=function(){c.getTranslate("licenseData",function(n){n=n.replace(/\d\./g,function(e){return"<br/>"+e}),n=n.replace(/^<br\/>/,""),e.license=r.trustAsHtml(n),e.flag=!1})},y=function(){var e;return e=c.getSearch([{key:"lang",value:_}]),g.push({languages:"/cgi-bin/luci/api/guide/lang?"+e}),!0},k=function(){var n,t;return t=typeof e.guide.newPwd,void 0!==t&&"string"===t&&""!==e.guide.newPwd&&(S=e.guide.newPwd,"admin"===S?!u.warn("unsafePwd"):!!L(e.sync.syncWifiPwd)&&(n=c.getSearch([{key:"password",value:S}]),g.push({pwd:"/cgi-bin/luci/api/guide/password?"+n}),!0))},P=function(){var n;return"pppoe"===e.wan_conf.proto&&(!!c.checkParameter(e.wan_conf.pppoe.uname,{name:"Username"})&&(!!c.checkParameter(e.wan_conf.pppoe.pwd,{name:"Password"})&&(n=c.getSearch([{key:"username",value:e.wan_conf.pppoe.uname},{key:"password",value:e.wan_conf.pppoe.pwd},{key:"proto",value:e.wan_conf.proto}]),g.push({wan:"/cgi-bin/luci/api/guide/wan?"+n}),!0)))},C=function(){var n;return"static"===e.wan_conf.proto&&(!!c.checkParameter(e.wan_conf["static"].ipaddr,{name:"Ipaddr",ip:!0})&&(!!c.checkParameter(e.wan_conf["static"].netmask,{name:"Subnet",ip:!0})&&(!!c.checkParameter(e.wan_conf["static"].gateway,{name:"Gateway",ip:!0})&&(/^(0+\.){3}0+$/.test(e.wan_conf["static"].ipaddr)?!u.warn("IP Address cannot be '0.0.0.0'"):/^127/.test(e.wan_conf["static"].ipaddr)?!u.warn("IP Address cannot be '127.*.*.*'"):/^(0+\.){3}0+$/.test(e.wan_conf["static"].netmask)?!u.warn("IP Address cannot be '0.0.0.0'"):/^127/.test(e.wan_conf["static"].gateway)?!u.warn("IP Address cannot be '127.*.*.*'"):(n=c.getSearch([{key:"ipaddr",value:e.wan_conf["static"].ipaddr},{key:"subnet",value:e.wan_conf["static"].netmask},{key:"gateway",value:e.wan_conf["static"].gateway},{key:"proto",value:e.wan_conf.proto}]),g.push({wan:"/cgi-bin/luci/api/guide/wan?"+n}),!0)))))},A=function(){var n;return"dhcp"===e.wan_conf.proto&&(n=c.getSearch([{key:"proto",value:e.wan_conf.proto}]),g.push({wan:"/cgi-bin/luci/api/guide/wan?"+n}),!0)},N=function(){var n,t;if(n=[{key:"disabled",value:0},{key:"wname",value:e.wifi_conf.wname_24},{key:"device",value:e.wifi_conf.device_24},{key:"channel",value:"auto"},{key:"encryption",value:"psk+psk2"},{key:"ssid",value:e.wifi_conf.base_ssid},{key:"key",value:e.wifi_conf.base_pwd}],t=[{key:"disabled",value:0},{key:"wname",value:e.wifi_conf.wname_58},{key:"device",value:e.wifi_conf.device_58},{key:"channel",value:"auto"},{key:"encryption",value:"psk+psk2"},{key:"ssid",value:e.wifi_conf.base_ssid+"_5G"},{key:"key",value:e.wifi_conf.base_pwd}],"easy"===e.wifi_conf.mode){if(!c.checkParameter(e.wifi_conf.base_ssid,{name:"SSID"}))return!1;if(!c.checkParameter(e.wifi_conf.base_pwd,{minLen:8}))return!1}else if("more"===e.wifi_conf.mode){if(!c.checkParameter(e.wifi_conf.adv24_ssid,{name:"SSID"}))return!1;if(!c.checkParameter(e.wifi_conf.adv58_ssid,{name:"SSID"}))return!1;if(!c.checkParameter(e.wifi_conf.adv58_pwd,{minLen:8}))return!1;if(!c.checkParameter(e.wifi_conf.adv24_pwd,{minLen:8}))return!1;n.pop(),n.pop(),n.push({key:"ssid",value:e.wifi_conf.adv24_ssid}),n.push({key:"key",value:e.wifi_conf.adv24_pwd}),t.pop(),t.pop(),t.push({key:"ssid",value:e.wifi_conf.adv58_ssid}),t.push({key:"key",value:e.wifi_conf.adv58_pwd})}return n=c.getSearch(n),t=c.getSearch(t),h&&g.push({wifi24:"/cgi-bin/luci/api/guide/wifi?"+n}),v&&g.push({wifi58:"/cgi-bin/luci/api/guide/wifi?"+t}),!0},m=function(){var n;p.mobile?c.getTranslate(["reconnetWifi","wifi_ssid","wifi_password"],function(n){var t;t=n.reconnetWifi,"more"===e.wifi_conf.mode?(t+=n.wifi_ssid+": "+e.wifi_conf.adv24_ssid,t+=n.wifi_password+": "+e.wifi_conf.adv24_pwd,t+=n.wifi_ssid+": "+e.wifi_conf.adv58_ssid,t+=n.wifi_password+": "+e.wifi_conf.adv58_pwd):"easy"===e.wifi_conf.mode&&(t+=n.wifi_ssid+": "+e.wifi_conf.base_ssid,t+=n.wifi_password+": "+e.wifi_conf.base_pwd,t+=n.wifi_ssid+": "+e.wifi_conf.base_ssid+"_5G",t+=n.wifi_password+": "+e.wifi_conf.base_pwd),d.text(t)}):n=c.ping("/cgi-bin/luci/api/guide/status",function(e){var t;if(angular.isString(e))try{e=JSON.parse(e)}catch(o){return t=o,void console.warn(t)}0===e.code&&(e=e.content,angular.isArray(e)&&e.length>0&&(l.sys.guide=e[0].isGuide),"0"===l.sys.guide&&(a.cancel(n),b()))})},b=function(e){null==e&&(e=!1),e||u.success("Configuration Complete"),c.postJSON("/cgi-bin/luci/api/sys/login?username=root&password="+S,function(e){0===e.code?(l.user=e.content[0],d.closeAll(),window.localStorage.setItem("pb.startTime",(new Date).getTime()),window.localStorage.setItem("pb.user",JSON.stringify(l.user)),t.path("/home")):(console.error(e),window.localStorage.setItem("pb.startTime",-3600),window.localStorage.setItem("pb.user",null),t.path("/login"))},function(){u.warn("Network_Timeout!"),setTimeout(function(){u.warn("PlsCheckPing")},1500)})},f=function(){var e,t,a,r,s,l;e=0,r=0,s=g.length,t=1,a="",c.getTranslate("Configuration Complete",function(e){a=e}),l=function(r){var p,f,w,h;if(r>=s)return e=0,m();r>D.length-1&&d.text("rebooting"),r>0&&(t=2e3+1e3*e),w="",f=g[r];for(p in f)h=f[p],w=h;return e>2?(i.reload(),void u.warn("PlsCheckPing")):void n.get(w).success(function(){d.closeAll(),r<D.length&&c.getTranslate(D[r],function(e){u.success(""+e+a)}),o(function(){e=0,l(++r)},t)}).error(function(){d.closeAll(),++e,l(r)})},o(function(){l(r)},200)},T=function(){c.postJSON("/cgi-bin/luci/api/guide/wan.proto",function(n){var t;if(0===n.code&&(t=n.content.shift(),!angular.isUndefined(t))){switch(t=t.proto){case 0:e.wan_conf.proto="dhcp";break;case 1:e.wan_conf.proto="pppoe";break;case 8:u.warn("plsCheckLink");break;default:e.wan_conf.proto="static"}d.closeAll()}},function(){d.closeAll()})},function(){return"0"===l.sys.guide?void t.path("/home"):(d.loading(),l.user={},l.preSite=null,window.localStorage.setItem("pb.startTime",-3600),window.localStorage.setItem("pb.user",null),c.postJSON("/cgi-bin/luci/api/wan/status",function(n){var t;switch(n=n.content[0],t=n.proto,e.wan_conf.proto=t,t){case"pppoe":e.wan_conf.pppoe.uname=n.username,e.wan_conf.pppoe.pwd=n.password;break;case"static":e.wan_conf["static"].ipaddr=n.ipaddr,e.wan_conf["static"].netmask=n.subnet,e.wan_conf["static"].gateway=n.gateway}},function(){u.error("Network_Timeout!")}),c.postJSON("/cgi-bin/luci/api/wifi/status",function(n){n=n.content,n.length<=0||(1===n.length?e.wifi_conf.single=!0:n.length>=2&&(e.wifi_conf.single=!1),n.forEach(function(n){switch(n.type){case"2.4":e.wifi_conf.base=1,e.wifi_conf.wname_24=n.wname,e.wifi_conf.device_24=n.device,e.wifi_conf.adv24_ssid=n.ssid,e.wifi_conf.adv24_pwd=n.key,e.wifi_conf.base_ssid=n.ssid,e.wifi_conf.base_pwd=n.key,h=!0,D.push("wifi_mode_24");break;case"5.8":e.wifi_conf.advance=1,e.wifi_conf.wname_58=n.wname,e.wifi_conf.device_58=n.device,e.wifi_conf.adv58_ssid=n.ssid,e.wifi_conf.adv58_pwd=n.key,v=!0,D.push("wifi_mode_58")}}))},function(){u.error("Network_Timeout!")}),void o(d.closeAll,300))}()}])}.call(this),function(){"use strict";angular.module("pbApp").controller("LoginController",["$scope","$location","$route","$timeout","Data","Dialog","Fn","Toast",function(e,n,t,a,o,i,r,s){var l;return"1"===o.sys.guide?n.path("/guide"):r.getLoginStatus()?n.path("/home"):(null==(l=o.user).username&&(l.username="root"),e.user=o.user,i.closeAll(),console.info("样子这么丑, 不是我干的, 是Lintel 威逼我的!!!"),void(e.login=function(){var t;r.checkParameter(e.user.password,{name:"Password"})&&(i.text("logining"),t="username="+e.user.username+"&password="+e.user.password,r.postJSON("/cgi-bin/luci/api/sys/login?"+t,function(e){return i.closeAll(),0===e.code?(o.user=e.content[0],window.localStorage.setItem("pb.startTime",(new Date).getTime()),window.localStorage.setItem("pb.user",JSON.stringify(o.user)),void(angular.isString(o.preSite)&&o.preSite.length>0?(n.path(o.preSite),o.preSite=null):n.path("/home"))):void((/username/i.test(e.code_info)||/password/i.test(e.code_info))&&(console.warn(e.code_info),s.error("invalidLogin")))},function(){i.closeAll(),s.warn("Network_Timeout!"),a(function(){s.error("PlsCheckPing")},1500)}))}))}])}.call(this),function(){"use strict";var e;e=angular.module("pbApp"),e.controller("PluginController",["$scope","Fn","Data",function(e,n,t){angular.isUndefined(t.plugins)&&(t.plugins=[]),e.plugins=t.plugins,n.partialLoadLang("plugin"),n.postJSON("/cgi-bin/luci/api/plugin/list?theme=lafite",function(n){var a,o;0===n.code&&(o=function(){var e,t,o,i;for(o=n.content,i=[],e=0,t=o.length;e<t;e++)a=o[e],a.installed&&i.push(a);return i}(),t.plugins!==o&&(e.plugins=t.plugins=o))})}]).config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function(n,t,a,o){e.register={controller:n.register,directive:t.directive,filter:a.register,factory:o.factory,service:o.service}}])}.call(this),function(){"use strict";angular.module("pbApp").controller("DdnsController",["$scope","$location","Data","Fn","Toast","Dialog",function(e,n,t,a,o,i){var r,s;a.getLoginStatus()||(t.preSite=n.path(),n.path("/login")),a.partialLoadLang("adv"),null==t.adv&&(t.adv={ddns:{}}),null==(r=t.adv).ddns&&(r.ddns={}),e.ddns=t.adv.ddns,s=function(n){var a,o,i,r;if(!(angular.isUndefined(n)||angular.isUndefined(n.code)||angular.isUndefined(n.content))){if(n.code&&0!==n.code)return console.warn(n.code_info),n.code;for(r=n.content,a=0,i=r.length;a<i;a++)o=r[a],"myddns_ipv6"!==o.wname&&(e.ddns=t.adv.ddns=o);return n.code}},e.update=function(){var n;if(!a.getLoginStatus())return i.reLogin(e.update);if(a.checkParameter(e.ddns.service_name,{name:"service_name"})&&a.checkParameter(e.ddns.domain,{name:"domain"})&&a.checkParameter(e.ddns.username,{name:"username"})&&a.checkParameter(e.ddns.password,{name:"password"}))return n=[{key:"service_name",value:e.ddns.service_name},{key:"domain",value:e.ddns.domain},{key:"service_username",value:e.ddns.username},{key:"service_password",value:e.ddns.password},{key:"wname",value:e.ddns.wname}],a.postJSON("/cgi-bin/luci/api/ddns/setter?"+a.getSearch(n),function(e){return 0===s(e)&&o.success("DDNS Setting Success!"),i.closeAll()},function(){return i.closeAll(),o.error("Network_Timeout!")})},a.postJSON("/cgi-bin/luci/api/ddns/status?"+a.getSearch(),function(e){return s(e),i.closeAll()},function(){return i.closeAll(),o.error("Network_Timeout!")})}])}.call(this),function(){"use strict";var e;e=angular.module("pbApp").controller("DmzController",["$scope","$location","Data","Fn","Toast","Dialog",function(e,n,t,a,o,i){var r,s,l,c,u,d,p,f,g;a.getLoginStatus()||(t.preSite=n.path(),n.path("/login")),a.partialLoadLang("adv"),null==t.adv&&(t.adv={}),null==e.dmz&&(e.dmz=[]),null==(r=t.adv).dmz&&(r.dmz=[]),p=function(n){return angular.isUndefined(n.code)?-1:40003===n.code?(e.dmz=[],t.adv.dmz=[],0):0!==n.code?(console.warn(n.code_info),n.code):(angular.isDefined(n.content)&&(e.dmz=n.content,t.adv.dmz=n.content),n.code)},s={names:[{key:"name",value:"dmz_name"},{key:"proto",value:"dmz_proto"},{key:"dest_ip",value:"dmz_dest_ip"},{key:"dest_port",value:"dmz_dest_port"},{key:"src_dport",value:"dmz_src_dport"},{key:"wname",value:""}],negativebtn:"Cancel"},l={proto:{"default":"TCP",list:!0,items:["TCP","UDP","ICMP"],Upper:!0},dest_ip:{"default":"0.0.0.0",ip:!0},dest_port:{"default":"0"},src_dport:{"default":"0"},wname:{display:"none"}},d=function(e){var n;return n="invalidPort",""===e?!o.warn(n):/\D/.test(e)?!o.warn(n):parseInt(e,10)<=0?!o.warn(n):!(parseInt(e,10)>65535)||!o.warn(n)},g=function(e,n,a){var o,i,r,s;if(a)for(s=t.adv.dmz,i=0,r=s.length;i<r;i++)if(o=s[i],"DMZ"===o.name)return void f(o,n);f(e,n)},f=function(e,n){var t,r,c,u,d;if(!a.getLoginStatus())return i.reLogin(function(){f(e,n)});if(r=angular.copy(s),u={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/dmz/setter",options:null!=n?n:angular.copy(l)},null==e)r.positivebtn="Add",r.title="dmz_title_add",u.options.wname.optional=!0,u.submitFn=function(e){0===p(e)&&o.success("Add Success!")};else{r.positivebtn="Update",r.title="dmz_title_update",u.options.wname.optional=!1,u.submitFn=function(e){0===p(e)&&o.success("Update Success!")};for(c in e)d=e[c],/\$/.test(c)||(null==(t=u.options)[c]&&(t[c]={}),u.options[c]["default"]=d)}i.open(r,u)},u=function(e,n){var t,r,l,c,d;if(!a.getLoginStatus())return i.reLogin(function(){u(e,n)});r=angular.copy(s),c={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/dmz/delete",options:n,submitFn:function(e){return 0===p(e)?(o.success("Delete Success!"),void a.postJSON("/cgi-bin/luci/api/dmz/status",function(e){return p(e)})):o.warn("Delete Fail!")}},r.positivebtn="Delete",r.title="dmz_title_delete";for(l in e)d=e[l],/\$/.test(l)||(null==(t=c.options)[l]&&(t[l]={}),c.options[l]["default"]=d,c.options[l].readonly=!0);i.open(r,c)},e.setPortForwarding=function(e){var n;n=angular.copy(l),n.dest_port.checkFn=d,n.src_dport.checkFn=d,g(e,n,!1)},e.setDMZ=function(e){var n;n=angular.copy(l),n.dest_port["default"]="all",n.src_dport["default"]="all",n.dest_port.display="none",n.src_dport.display="none",n.name={"default":"DMZ",display:"none"},g(e,n,!0)},c={proto:{display:"none"},dest_port:{display:"none"},src_dport:{display:"none"},wname:{display:"none"}},e.delPortForwarding=function(e){u(e,c)},e.delDMZ=function(e){c.name={display:"none"},u(e,c)},function(){a.postJSON("/cgi-bin/luci/api/dmz/status",function(e){p(e),i.closeAll()},function(){i.closeAll()})}()}])}.call(this),function(){"use strict";angular.module("pbApp").controller("QosController",["$scope","$http","$location","Data","Fn","Toast","Dialog",function(e,n,t,a,o,i,r){var s,l,c,u,d,p,f;o.getLoginStatus()||(a.preSite=t.path(),t.path("/login")),o.partialLoadLang("adv"),null==a.adv&&(a.adv={}),null==(s=a.adv).qos&&(s.qos={}),null==(l=a.adv.qos).mac&&(l.mac=[]),null==(c=a.adv.qos).ip&&(c.ip=[]),null==(u=a.adv.qos).rang&&(u.rang=[]),e.qos=a.adv.qos,e.getQosConf=function(){var n;return o.getLoginStatus()?(r.text("detectingQosConf"),n=o.getSearch([{key:"_method",value:"get"},{key:"type",value:"speedtest"}]),void o.postJSON("/cgi-bin/luci/api/wan/inspect?"+n,function(n){if(r.closeAll(),!angular.isUndefined(n.code)&&0===n.code&&!angular.isUndefined(n.content)&&0===n.code){if(n=n.content[0],angular.isDefined(n.error))return void i.error("qosDetectFail");e.qos.global.download=n.speed.download,e.qos.global.upload=n.speed.upload}},function(){r.closeAll(),i.error("qosDetectFail")})):r.reLogin(e.getQosConf)},f=function(n){var t,o,i,r,s;if(angular.isUndefined(n.code))return-1;if(40003===n.code)return e.qos=[],a.adv.qos=[],0;if(0!==n.code)return console.warn(n.code_info),n.code;if(angular.isDefined(n.content)&&(a.adv.qos=n.content[0]),angular.isDefined(a.adv.qos.rang))for(s=a.adv.qos.rang,t=0,r=s.length;t<r;t++)i=s[t],o=i.ipaddr.split("-"),i.start=o[0],i.limit=o[1];return e.qos=a.adv.qos,n.code},e.global=function(){var n,t,a;if(!o.getLoginStatus())return r.reLogin(e.global);if(o.checkParameter(e.qos.global.enabled,{name:"Enabled",number:!0})&&o.checkParameter(e.qos.global.download,{name:"Download",number:!0})&&o.checkParameter(e.qos.global.upload,{name:"Upload",number:!0})&&o.checkParameter(e.qos.global.packets_threshold,{name:"Packets Threshold",number:!0})&&o.checkParameter(e.qos.global.type,{name:"Reset_Type"})&&("mouthly"!==e.qos.global.type&&"weekly"!==e.qos.global.type&&"daily"!==e.qos.global.type||o.checkParameter(e.qos.global.hour,{name:"Hour",number:!0}))&&("mouthly"!==e.qos.global.type||o.checkParameter(e.qos.global.day,{name:"Day",number:!0}))&&("weekly"!==e.qos.global.type||o.checkParameter(e.qos.global.week,{name:"Week",number:!0}))){switch(a="/cgi-bin/luci/api/qos/setter",n=[{key:"type",value:"global"},{key:"download",value:e.qos.global.download},{key:"upload",value:e.qos.global.upload},{key:"packets_threshold",value:e.qos.global.packets_threshold},{key:"reset_type",value:e.qos.global.type}],e.qos.global.type){case"mouthly":n.push({key:"day",value:e.qos.global.day}),n.push({key:"hour",value:e.qos.global.hour});break;case"weekly":n.push({key:"week",value:e.qos.global.week}),n.push({key:"hour",value:e.qos.global.hour});break;case"daily":n.push({key:"hour",value:e.qos.global.hour})}r.applying(),t=o.getSearch(n),o.postJSON(a+"?"+t,function(e){0===f(e)?i.success("QoS Global Modify Success!"):i.warn("Modify Fail!"),r.closeAll()},function(){r.closeAll(),i.error("Network_Timeout!")})}},d=[{key:"download_threshold",value:"qos_client_download_threshold"},{key:"upload_threshold",value:"qos_client_upload_threshold"},{key:"download",value:"qos_client_download"},{key:"upload",value:"qos_client_upload"},{key:"ports",value:""},{key:"comment",value:""},{key:"priority",value:""},{key:"wname",value:""},{key:"type",value:""}],p={macaddr:{mac:!0},ipaddr:{ip:!0},start:{ip:!0},limit:{ip:!0},download_threshold:{"default":"0",ext:"kb",speed:!0},upload_threshold:{"default":"0",ext:"kb",speed:!0},download:{"default":"0",ext:"kbs",speed:!0,Kb2KB:!0},upload:{"default":"0",ext:"kbs",speed:!0,Kb2KB:!0},ports:{"default":"20,25,80,443,53",display:"none"},comment:{"default":"ftp,smtp,http,dns",display:"none"},priority:{"default":"3",display:"none"},wname:{optional:!0,display:"none"},type:{"default":"client",display:"none"}},e.client_update_mac=function(n){var t,a,s,l;if(!o.getLoginStatus())return r.reLogin(function(){e.client_update_mac(n)});if(t={names:[{key:"macaddr",value:"qos_client_macaddr"}]},s={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/qos/setter",options:angular.copy(p),submitFn:function(e){0===f(e)?i.success("QoS Modify Success!"):i.warn("Modify Fail!")}},t.names=t.names.concat(d),null==n)t.title="add_regular",t.positivebtn="Add";else{t.title="update_regular",t.positivebtn="Update";for(a in n)l=n[a],/\$/.test(a)||(s.options[a]["default"]=l)}t.negativebtn="Cancel",r.open(t,s)},e.client_update_ip=function(n){var t,a,s,l;if(!o.getLoginStatus())return r.reLogin(function(){e.client_update_ip(n)});if(t={names:[{key:"ipaddr",value:"qos_client_ipaddr"}]},s={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/qos/setter",options:angular.copy(p),submitFn:function(e){0===f(e)?i.success("QoS Modify Success!"):i.warn("Modify Fail!")}},t.names=t.names.concat(d),n){t.title="update_regular",t.positivebtn="Update";for(a in n)l=n[a],/\$/.test(a)||(s.options[a]["default"]=l)}else t.title="add_regular",t.positivebtn="Add";t.negativebtn="Cancel",r.open(t,s)},e.client_update_rang=function(n){var t,a,s,l;if(!o.getLoginStatus())return r.reLogin(function(){e.client_update_rang(n)});if(t={names:[{key:"start",value:"qos_ipaddr_start"},{key:"limit",value:"qos_ipaddr_end"}],title:"delete_regular",positivebtn:"Delete",negativebtn:"Cancel"},s={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/qos/setter",options:angular.copy(p),submitFn:function(e){0===f(e)?i.success("QoS Modify Success!"):i.warn("Modify Fail!")}},t.names=t.names.concat(d),n){t.title="update_regular",t.positivebtn="Update";for(a in n)l=n[a],/\$/.test(a)||(s.options[a]["default"]=l)}else t.title="add_regular",t.positivebtn="Add";r.open(t,s)},e.client_delete_mac=function(n){var t,a,s,l;if(!o.getLoginStatus())return r.reLogin(function(){e.client_delete_mac(n)});if(null!=n){t={names:[{key:"macaddr",value:"qos_client_macaddr"},{key:"wname",value:""}],title:"delete_regular",positivebtn:"Delete",negativebtn:"Cancel"},s={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/qos/delete",options:angular.copy(p),submitFn:function(e){0===f(e)?(i.success("Delete Success!"),o.postJSON("/cgi-bin/luci/api/qos/status",function(e){return f(e)})):i.warn("Delete Fail!")}};for(a in n)l=n[a],/\$/.test(a)||(s.options[a]["default"]=l,s.options[a].readonly=!0);r.open(t,s)}},e.client_delete_ip=function(n){var t,a,s,l;if(!o.getLoginStatus())return r.reLogin(function(){e.client_delete_ip(n)});if(n){t={names:[{key:"ipaddr",value:"qos_client_ipaddr"},{key:"wname",value:""}],title:"delete_regular",positivebtn:"Delete",negativebtn:"Cancel"},s={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/qos/delete",options:angular.copy(p),submitFn:function(e){0===f(e)?(i.success("Delete Success!"),o.postJSON("/cgi-bin/luci/api/qos/status",function(e){return f(e)})):i.warn("Delete Fail!")}};for(a in n)l=n[a],/\$/.test(a)||(s.options[a]["default"]=l,s.options[a].readonly=!0);r.open(t,s)}},e.client_delete_rang=function(n){var t,a,s,l;if(!o.getLoginStatus())return r.reLogin(function(){e.client_delete_rang(n)});if(null!=n){t={names:[{key:"start",value:"qos_ipaddr_start"},{key:"limit",value:"qos_ipaddr_end"},{key:"wname",value:""}],title:"delete_regular",positivebtn:"Delete",negativebtn:"Cancel"},s={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/qos/delete",options:angular.copy(p),submitFn:function(e){0===f(e)?(i.success("Delete Success!"),o.postJSON("/cgi-bin/luci/api/qos/status",function(e){return f(e)})):i.warn("Delete Fail!")}};for(a in n)l=n[a],/\$/.test(a)||(s.options[a]["default"]=l,s.options[a].readonly=!0);r.open(t,s)}},o.postJSON("/cgi-bin/luci/api/qos/status",function(e){f(e),r.closeAll()},function(){r.closeAll(),i.error("Network_Timeout!")})}])}.call(this),function(){"use strict";angular.module("pbApp").controller("StaticController",["$scope","$location","Data","Fn","Toast","Dialog",function(e,n,t,a,o,i){var r,s;a.getLoginStatus()||(t.preSite=n.path(),n.path("/login")),a.partialLoadLang("adv"),null==t.adv&&(t.adv={}),e["static"]=null!=(r=t.adv)["static"]?r["static"]:r["static"]=[],s=function(n){return angular.isUndefined(n.code)?-1:40003===n.code?(e["static"]=t.adv["static"]=[],0):0!==n.code?(console.warn(n.code_info),n.code):(angular.isDefined(n.content)&&(e["static"]=t.adv["static"]=n.content),n.code)},e.update=function(n){var t,r,l,c,u;if(!a.getLoginStatus())return i.reLogin(function(){e.update(n)});if(r={names:[{key:"name",value:"static_name"},{key:"ipaddr",value:"static_ipaddr"},{key:"macaddr",value:"static_macaddr"},{key:"wname",value:""}],negativebtn:"Cancel"},c={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/dhcp/setter",options:{ipaddr:{"default":"0.0.0.0",ip:!0},macaddr:{"default":"00:00:00:00:00:00",mac:!0},wname:{display:"none"},name:{"default":"UKNOWN"}},submitFn:function(e){0===s(e)?o.success("Add Success!"):o.success("Add Fail!")}},n){r.title="update_static_ipaddr",r.positivebtn="Update",c.options.wname.optional=!1,c.submitFn=function(e){0===s(e)?o.success("Update Success!"):o.success("Update Fail!")};for(l in n)u=n[l],/\$/.test(l)||(null==(t=c.options)[l]&&(t[l]={}),c.options[l]["default"]=u)}else r.title="add_static_ipaddr",r.positivebtn="Add",c.options.wname.optional=!0,c.submitFn=function(e){0===s(e)?o.success("Add Success!"):o.success("Add Fail!")};i.open(r,c)},e["delete"]=function(n){var t,r,l,c,u;if(!a.getLoginStatus())return i.reLogin(function(){e["delete"](n)});if(!angular.isUndefined(n)){r={names:[{key:"name",value:"static_name"},{key:"ipaddr",value:"static_ipaddr"},{key:"macaddr",value:"static_macaddr"},{key:"wname",value:""}],title:"delete_static_ipaddr",positivebtn:"Delete",negativebtn:"Cancel"},c={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/dhcp/delete",options:{wname:{display:"none"}},submitFn:function(e){0===s(e)?o.success("Delete Success!"):o.success("Delete Fail!")}};for(l in n)u=n[l],/\$/.test(l)||(null==(t=c.options)[l]&&(t[l]={}),c.options[l]["default"]=u,c.options[l].readonly=!0);i.open(r,c)}},a.postJSON("/cgi-bin/luci/api/dhcp/status",function(e){s(e),i.closeAll()},function(){i.closeAll(),o.error("Network_Timeout!")})}])}.call(this),function(){"use strict";angular.module("pbApp").controller("UpnpController",["$scope","$location","Data","Dialog","Toast","Fn",function(e,n,t,a,o,i){var r,s;return i.getLoginStatus()?(i.partialLoadLang("adv"),null==t.adv&&(t.adv={}),e.upnp=null!=(r=t.adv).upnp?r.upnp:r.upnp={},s=function(n){if(!angular.isUndefined(n)){if(n.code&&0!==n.code&&40003!==n.code)return console.warn(n.code_info),n.code;if(!angular.isUndefined(n.content))return 0===n.code&&(t.adv.upnp=n.content[0]),e.upnp=t.adv.upnp,angular.isArray(n.content[0].list)&&!n.content[0].list.length&&(t.adv.upnp.list=[]),n.code}},void i.postJSON("/cgi-bin/luci/api/upnp/status",function(e){s(e),a.closeAll()},function(){a.closeAll(),o.error("Network_Timeout!")})):(t.preSite=n.path(),void n.path("/login"))}])}.call(this),function(){"use strict";angular.module("pbApp").controller("AdvController",["$scope","$location","Data","Dialog",function(e,n,t,a){return a.closeAll(),t.sys.hasQos?n.path("/adv/adv_qos"):t.sys.hasUpnp?n.path("/adv/adv_upnp"):t.sys.hasStatic?n.path("/adv/adv_static"):t.sys.hasDDNS?n.path("/adv/adv_ddns"):t.sys.hasDMZ?n.path("/adv/adv_dmz"):n.path("/index")}])}.call(this),function(){"use strict";angular.module("pbApp").controller("HomeController",["$scope","$location","Data","Fn",function(e,n,t,a){var o;return a.getLoginStatus()?(null==(o=t.sys).mainPage&&(o.mainPage="Menu"),window.localStorage.getItem("pb.mainPage")&&(t.sys.mainPage=window.localStorage.getItem("pb.mainPage")),"Menu"===t.sys.mainPage?n.path("/menu"):"Status"===t.sys.mainPage?n.path("/status"):void 0):(t.preSite=n.path(),void n.path("/login"))}])}.call(this),function(){"use strict";angular.module("pbApp").controller("MenuController",["$scope","$location","Dialog","Data","Fn","navArr",function(e,n,t,a,o,i){return o.getLoginStatus()||(a.preSite=n.path(),n.path("/login")),e.navArr=i,t.closeAll()}])}.call(this),function(){"use strict";angular.module("pbApp").controller("HwnatController",["$scope","$location","Dialog","Toast","Data","HwnatPowerOptions","Fn",function(e,n,t,a,o,i,r){var s,l;r.getLoginStatus()||(o.preSite=n.path(),n.path("/login")),t.closeAll(),r.partialLoadLang("hwnat"),null==e.hwnat&&(e.hwnat=[]),e.hwnatPowerOptions=i,l=function(n){var t,o,r,s,l,c,u,d,p,f,g;if(angular.isUndefined(n.code)||0!==n.code&&60001!==n.code)return a.warn("Network_Timeout!"),console.warn(n.code_info),n.code;if(60001===n.code)return console.warn(n.code_info),
n.code;if(angular.isUndefined(n.content))return-1;if(angular.isUndefined(e.hwnat))e.hwnat=n.content;else if(angular.isArray(e.hwnat)||0===e.hwnat.length||e.hwnat.length!==n.content.length)e.hwnat=n.content;else for(p=e.hwnat,o=0,c=p.length;o<c;o++)for(r=p[o],f=n.content,s=0,u=f.length;s<u;s++)t=f[s],r.wname===t.wname&&(r=t);for(g=e.hwnat,l=0,d=g.length;l<d;l++)r=g[l],angular.isUndefined(r.enabled)&&(r.enabled="0"),angular.isUndefined(r.tcp_offload)&&(r.tcp_offload="0"),angular.isUndefined(r.udp_offload)&&(r.udp_offload="0"),angular.isUndefined(r.ipv6_offload)&&(r.ipv6_offload="0"),angular.isUndefined(r.wifi_offload)&&(r.wifi_offload="0"),r.enabled&&(r.enabled_text=i[r.enabled].value),r.tcp_offload&&(r.tcp_offload_text=i[r.tcp_offload].value),r.udp_offload&&(r.udp_offload_text=i[r.udp_offload].value),r.ipv6_offload&&(r.ipv6_offload_text=i[r.ipv6_offload].value),r.wifi_offload&&(r.wifi_offload_text=i[r.wifi_offload].value);return e.$watch("hwnat[0].enabled",function(){angular.isUndefined(e.hwnat[0].tcp_offload)||(e.hwnat[0].tcp_offload=e.hwnat[0].enabled,"1"===e.hwnat[0].enabled||1===e.hwnat[0].enabled?e.hwnat[0].tcp_offload_text="ON":"0"!==e.hwnat[0].enabled&&0!==e.hwnat[0].enabled||(e.hwnat[0].tcp_offload_text="OFF"))}),n.code},s=function(e,n,t){e[n]=t.key,e[n+"_text"]=t.value},e.udpChange=function(e,n){s(e,"udp_offload",n)},e.ipv6Change=function(e,n){s(e,"ipv6_offload",n)},e.wifiChange=function(e,n){s(e,"wifi_offload",n)},e.submit=function(){var n,t,a,o,i,s;if(!angular.isUndefined(e.hwnat[0])){for(t=e.hwnat[0],n=[{key:"enabled",value:t.enabled},{key:"wname",value:t.wname}],s=["tcp_offload","udp_offload","ipv6_offload","wifi_offload"],a=0,i=s.length;a<i;a++)o=s[a],"1"===t.enabled&&n.push({key:""+o,value:t[o]});r.postJSON("/cgi-bin/luci/api/hwacc/setter?"+r.getSearch(n),function(e){l(e)})}},r.postJSON("/cgi-bin/luci/api/hwacc/status",function(e){l(e)})}]).constant("HwnatPowerOptions",[{key:"0",value:"OFF"},{key:"1",value:"ON"}])}.call(this),function(){"use strict";angular.module("pbApp").controller("LanController",["$scope","$http","$location","$interval","$window","$timeout","Data","Fn","Toast","Dialog",function(e,n,t,a,o,i,r,s,l,c){var u,d,p;s.getLoginStatus()||(r.preSite=t.path(),t.path("/login")),s.partialLoadLang("lan"),r.lan.ip&&(e.lan=r.lan),d="/cgi-bin/luci/api/lan/setter?",u=function(n,t){var a,o,i,r,s,l,c;if(!(angular.isUndefined(n)||angular.isUndefined(t)||(s=t.split("."),s.length<=0)))for(l=0,a=s.length-1,i=0,r=s.length;i<r;i++)c=s[i],o=parseInt(c,10),a>0?l+=256*(255-o)*a:0===a&&(l+=256-o,e.sum=l-2-parseInt(n,10)+1),--a},p=function(n){var t,a;return n.code&&0!==n.code?(console.warn(n.code_info),c.closeAll(),n.code):angular.isArray(n.content)?(t=n.content[0],angular.isDefined(r.sys.isExpert)&&(t.expert=r.sys.isExpert),t.macaddr&&(t.macaddr=t.macaddr.toUpperCase().replace(/:/g,"-")),t.macoldaddr?t.macoldaddr=t.macoldaddr.toUpperCase().replace(/:/g,"-"):t.macoldaddr=null!=(a=t.macaddr)?a.toUpperCase().replace(/:/g,"-"):void 0,u(t.start,t.netmask),angular.isString(t.ignore)||(t.ignore+=""),!t.start_text&&t.start&&(t.start_text=t.start),!t.limit_text&&t.limit&&(t.limit_text=t.limit),!t.leasetime_text&&t.leasetime&&(t.leasetime_text=t.leasetime),!t.ip_text&&t.ip&&(t.ip_text=t.ip),!t.netmask_text&&t.netmask&&(t.netmask_text=t.netmask),angular.isDefined(t.leasetime&&/(h|m)$/.test(t.leasetime))&&(t.leasetime_text=t.leasetime.slice(0,-1)),e.dhcpSwitchLock=!1,e.lan=t,r.lan=t,n.code):-1},e.dhcpCheck=function(){var n,t,a;angular.isUndefined(e.lan)||(angular.isUndefined(e.lan.start_text)&&angular.isDefined(e.lan.start)&&(e.lan.start_text=e.lan.start),angular.isUndefined(e.lan.limit_text)&&angular.isDefined(e.lan.limit)&&(e.lan.limit_text=e.lan.limit),angular.isUndefined(e.lan.leasetime_text)&&angular.isDefined(e.lan.leasetime)&&(e.lan.leasetime_text=e.lan.leasetime.slice(0,-1)),a=parseInt(e.lan.start_text,10),t=parseInt(e.lan.limit_text,10),n=parseInt(e.lan.leasetime_text,10),(a>254||a<2)&&(e.lan.start_text=e.lan.start),u(a,e.lan.netmask),t>e.sum&&(e.lan.limit_text=e.sum),t<2&&(e.lan.limit_text=e.lan.limit),(n<1||n>72)&&(e.lan.leasetime_text=e.lan.leasetime.slice(0,-1)))},e.dhcp=function(){var n,t,a,o,i;return s.getLoginStatus()?void(angular.isUndefined(e.lan)||s.checkParameter(e.lan.ignore,{name:"Ignore"})&&(i=parseInt(e.lan.start_text,10),a=parseInt(e.lan.limit_text,10),t=parseInt(e.lan.leasetime_text,10),i<2||i>253||(n=[{key:"ignore",value:e.lan.ignore},{key:"start",value:i},{key:"limit",value:a}],t&&(t<1||t>72?t="72h":t+="h",n.push({key:"leasetime",value:t})),o=s.getSearch(n),c.applying(),s.postJSON(""+d+o,function(e){0===p(e)&&(s.postJSON("/cgi-bin/luci/api/lan/status",function(e){return p(e)}),l.success("DHCP Server Setting Success!"),c.closeAll())},function(){l.error("Network_Timeout!"),c.closeAll()})))):c.reLogin(e.dhcp)},e.gateway=function(){var t,r;if(!s.getLoginStatus())return c.reLogin(e.gateway);if(!angular.isUndefined(e.lan)&&s.checkParameter(e.lan.ip_text,{name:"Ipaddr",ip:!0})){if(/^(0+\.){3}0+$/.test(e.lan.ip_text))return l.warn("IP Address cannot be '0.0.0.0'");if(/^127/.test(e.lan.ip_text))return l.warn("IP Address cannot be '127.*.*.*'");t="http://"+e.lan.ip_text+"/index.html#/exit",e.lan.ip_text===e.lan.ip&&e.lan.netmask_text===e.lan.netmask||(r=s.getSearch([{key:"ipaddr",value:e.lan.ip_text},{key:"netmask",value:e.lan.netmask_text}]),c.applying(),s.postJSON(""+d+r,function(){var e;l.success("Lan Setting Success!"),c.close(),c.text("rebooting"),e=new Date,i(function(){var i;i=a(function(){return n.get(t+"?rnd="+e.getTime()).success(function(){a.cancel(i),c.close(),o.location.href=t}).error(function(){o.location.href=t})},2e3)},2e4)}))}},e.lanMac=function(){var n,t;if(!s.getLoginStatus())return c.reLogin(e.lanMac);if(!angular.isUndefined(e.lan)){if("1"===e.lan.mac_clone){if(!s.checkParameter(e.lan.macaddr,{name:"Macaddr",mac:!0}))return;if(e.lan.macaddr=e.lan.macaddr.toLowerCase().replace(/-/g,":"),e.lan.macoldaddr=e.lan.macoldaddr.toLowerCase().replace(/-/g,":"),e.lan.macoldaddr===e.lan.macaddr)return;if(/^(((00:){5}00)|((ff:){5}ff)|(33:33:\S*)|(01:80:c2:\S*)|(01:00:5e:\S*))$/i.test(e.lan.macaddr)||/^(((00-){5}00)|((ff-){5}ff)|(33-33-\S*)|(01-80-c2-\S*)|(01-00-5e-\S*))$/i.test(e.lan.macaddr))return;n=e.lan.macaddr}else n=e.lan.macoldaddr;n=n.toLowerCase().replace(/-/g,":"),t=s.getSearch([{key:"mac_clone",value:e.lan.mac_clone},{key:"macaddr",value:n}]),c.applying(),s.postJSON("/cgi-bin/luci/api/lan/mac?"+t,function(e){0===p(e)&&(l.success("Mac Address Clone Success!"),c.closeAll())},function(){l.error("Network_Timeout!"),c.closeAll()})}},s.postJSON("/cgi-bin/luci/api/lan/status",function(e){p(e),c.closeAll()},function(){l.error("Network_Timeout!"),c.closeAll()})}])}.call(this),function(){"use strict";angular.module("pbApp").controller("WanController",["$scope","$location","Data","WanProtos","Fn","Toast","Dialog",function(e,n,t,a,o,i,r){var s,l,c,u;o.getLoginStatus()||(t.preSite=n.path(),n.path("/login")),o.partialLoadLang("wan"),t.wan.proto&&(e.wan=t.wan),e.protos=a,e.proto="",u="/cgi-bin/luci/api/wan/setter?",c=function(n){var a;if(angular.isUndefined(n.code)||angular.isUndefined(n.content))return console.warn("errorData"),void r.closeAll();if(0!==n.code)return console.warn(n.code_info),r.closeAll(),n.code;if(a=n.content[0],a.expert=!1,"1"===t.sys.isExpert&&(a.expert=!0),angular.isString(a.macaddr)&&a.macaddr.length>0&&(a.macaddr=a.macaddr.toUpperCase().replace(/:/g,"-"),angular.isUndefined(a.macoldaddr)?a.macoldaddr=a.macaddr.toUpperCase().replace(/:/g,"-"):a.macoldaddr=a.macoldaddr.toUpperCase().replace(/:/g,"-")),angular.isUndefined(a.mtu_text)&&angular.isDefined(a.mtu)&&(a.mtu_text=a.mtu),a.dns_text=["0.0.0.0","0.0.0.0"],angular.isDefined(a.peerdns)&&"0"===a.peerdns&&angular.isArray(a.dns))for(a.dns_text=a.dns;a.dns_text.length<2;)a.dns_text.push("0.0.0.0");return e.wan=a,t.wan=a,e.proto=t.wan.proto,n.code},e.switchMode=function(n){e.proto=n,e.wan.mtu_text=e.wan.mtu},e.mtucheck=function(){return l()},e.pppoe=function(){var n,t,a;return o.getLoginStatus()?void(angular.isUndefined(e.wan)||o.checkParameter(e.wan.password,{name:"Password"})&&(n=[{key:"username",value:e.wan.username},{key:"password",value:e.wan.password},{key:"proto",value:e.proto}],t=l(),t>=0&&n.push({key:"mtu",value:t}),a=o.getSearch(n.concat(s())),r.applying(),o.postJSON(""+u+a,function(e){0===c(e)&&(i.success("Internet Setting Success!"),r.closeAll())},function(){i.error("Network_Timeout!"),r.closeAll()}))):r.reLogin(e.pppoe)},e["static"]=function(){var n,t,a;if(!o.getLoginStatus())return r.reLogin(e["static"]);if(!angular.isUndefined(e.wan)&&o.checkParameter(e.wan.ipaddr,{name:"Ipaddr",ip:!0})&&o.checkParameter(e.wan.netmask,{name:"Netmask",ip:!0})&&o.checkParameter(e.wan.gateway,{name:"Gateway",ip:!0})){if(/^(0+\.){3}0+$/.test(e.wan.ipaddr))return i.warn("IP Address cannot be '0.0.0.0'");if(/^127/.test(e.wan.ipaddr))return i.warn("IP Address cannot be '127.*.*.*'");if(/^(0+\.){3}0+$/.test(e.wan.gateway))return i.warn("IP Address cannot be '0.0.0.0'");if(/^127/.test(e.wan.gateway))return i.warn("IP Address cannot be '127.*.*.*'");n=[{key:"ipaddr",value:e.wan.ipaddr},{key:"netmask",value:e.wan.netmask},{key:"gateway",value:e.wan.gateway},{key:"proto",value:e.proto}],t=l(),t>=0&&n.push({key:"mtu",value:t}),a=o.getSearch(n.concat(s())),r.applying(),o.postJSON(""+u+a,function(e){0===c(e)&&(i.success("Internet Setting Success!"),r.closeAll())},function(){i.error("Network_Timeout!"),r.closeAll()})}},e.dhcp=function(){var n,t,a;return o.getLoginStatus()?void(angular.isUndefined(e.wan)||(n=[{key:"proto",value:e.proto}],t=l(),t>=0&&n.push({key:"mtu",value:t}),a=o.getSearch(n.concat(s())),r.applying(),o.postJSON(""+u+a,function(e){0===c(e)&&(i.success("Internet Setting Success!"),r.closeAll())},function(){i.error("Network_Timeout!"),r.closeAll()}))):r.reLogin(e.dhcp)},e.wanMac=function(){var n,t;if(!o.getLoginStatus())return r.reLogin(e.wanMac);if(!angular.isUndefined(e.wan.macaddr)){if("1"===e.wan.mac_clone){if(!o.checkParameter(e.wan.macaddr,{name:"Macaddr",mac:!0}))return;if(e.wan.macaddr=e.wan.macaddr.toLowerCase().replace(/-/g,":"),e.wan.macoldaddr=e.wan.macoldaddr.toLowerCase().replace(/-/g,":"),e.wan.macoldaddr===e.wan.macaddr)return;if(/^(((00:){5}00)|((ff:){5}ff)|(33:33:\S*)|(01:80:c2:\S*)|(01:00:5e:\S*))$/i.test(e.wan.macaddr))return;if(/^(((00-){5}00)|((ff-){5}ff)|(33-33-\S*)|(01-80-c2-\S*)|(01-00-5e-\S*))$/i.test(e.wan.macaddr))return;n=e.wan.macaddr}else n=e.wan.macoldaddr;n=n.toLowerCase().replace(/-/g,":"),t=o.getSearch([{key:"mac_clone",value:e.wan.mac_clone},{key:"macaddr",value:n}]),r.applying(),o.postJSON("/cgi-bin/luci/api/wan/mac?"+t,function(e){0===c(e)&&(i.success("Mac Address Clone Success!"),r.closeAll())},function(){i.error("Network_Timeout!"),r.closeAll()})}},s=function(){var n,t,a;if(!e.wan.expert&&!/static/.test(e.proto))return[];if(angular.isArray(e.wan.dns_text)&&e.wan.dns_text.length<=0)return[];if(n=[{key:"peerdns",value:0}],a=0,t=!1,angular.isArray(e.wan.dns_text)&&0!==e.wan.dns_text.length?e.wan.dns_text.forEach(function(e){/^(0+\.){3}0+$/.test(e)?++a:/\.(0|255)$/.test(e)?t=!0:n.push({key:"dns",value:e})}):t=!0,t)return i.warn("invaliddns"),[];if(2===a&&"0"===e.wan.peerdns)return n[0].value=1,n;if(a<2){if(n.length<=1)return[];if(n.length>1)return n}return[]},l=function(){var n;return e.wan.expert?(angular.isDefined(e.wan.mtu_text)&&(n=parseInt(e.wan.mtu_text,10),"pppoe"===e.proto&&(n>1493||n<0)?e.wan.mtu_text=1492:(n>1500||n<0)&&(e.wan.mtu_text=1500)),e.wan.mtu_text):-1},o.postJSON("/cgi-bin/luci/api/wan/status?"+o.getSearch(),function(e){c(e),r.closeAll()},function(){i.error("Network_Timeout!"),r.closeAll()})}])}.call(this),function(){"use strict";angular.module("pbApp").controller("BaseController",["$scope","$route","$location","Data","ExpertItems","MainPageList","Dialog","Fn","Toast","$translate",function(e,n,t,a,o,i,r,s,l,c){var u,d,p,f,g;for(r.closeAll(),s.getLoginStatus()||(a.preSite=t.path(),t.path("/login")),s.partialLoadLang("setup"),e.baseSysConf={langOptions:a.sys.lang},e.languages=s.langlist,e.translate=function(){var t,o;return s.getLoginStatus()?(t=e.baseSysConf.langOptions,angular.isUndefined(t)||angular.isString(t)&&0===t.length?void 0:("auto"===t&&(t=(navigator.language||navigator.userLanguage).toLowerCase().replace("-","_")),o=s.getSearch([{key:"lang",value:t},{key:"custom",value:1}]),s.postJSON("/cgi-bin/luci/api/sys/lang?"+o,function(e){if(!(e.code&&0!==e.code||angular.isUndefined(e.content)))return e=e.content,angular.isDefined(e.length)&&e.length>0&&e[0].lang===t?(a.sys.lang=e[0].lang,n.reload(),l.success("applySuc"),c.use(a.sys.lang)):void 0},function(){return l.warn("Network_Timeout!")}))):r.reLogin(e.translate)},e.changeLang=function(n){angular.isString(n)&&0!==n.length&&(e.baseSysConf.langOptions=n)},e.hostName="",d=function(n){null==n&&(n=0),s.postJSON("/cgi-bin/luci/api/sys/hostname?_method=get",function(n){angular.isUndefined(n.code)||0!==n.code||angular.isUndefined(n.content)||0===n.code&&(e.hostName=n.content[0].hostname)},function(){n<3?d(n+1):l.warn("Network_Timeout!")})},d(0),e.setHost=function(){var n;return s.getLoginStatus()?void(angular.isString(e.hostName)&&(e.hostName.length<=0||(n=s.getSearch([{key:"_method",value:"put"},{key:"hostname",value:e.hostName}]),s.postJSON("/cgi-bin/luci/api/sys/hostname?"+n,function(n){angular.isUndefined(n.code)||0!==n.code||angular.isUndefined(n.content)||0===n.code&&(e.hostName=n.content[0].hostname,l.success("applySuc"))},function(){l.warn("Network_Timeout!")})))):r.reLogin(e.setHost)},u=0,f=o.length;u<f;u++)p=o[u],p.key===a.sys.isExpert&&(e.baseSysConf.expertItem_text=p.text);e.expertItems=o,e.expert=function(){var n;return s.getLoginStatus()?(n=s.getSearch([{key:"expert",value:function(){var n,t,a;for(a=[],n=0,t=o.length;n<t;n++)p=o[n],p.text===e.baseSysConf.expertItem_text&&a.push(p.key);return a}()}]),void s.postJSON("/cgi-bin/luci/api/sys/expert?"+n,function(e){angular.isUndefined(e.code)||0!==e.code||angular.isUndefined(e.content)||(e=e.content,angular.isArray(e)&&e.length>0&&(a.sys.isExpert=e[0].expert_mode,l.success("applySuc")))},function(){return l.warn("Network_Timeout!")})):r.reLogin(e.expert)},e.changeExpert=function(n){angular.isUndefined(n)||(e.baseSysConf.expertItem_text=n.text)},e.baseSysConf.mainPage=null!=(g=a.sys.mainPage)?g:"Menu",e.baseSysConf.mainPage="MainPage"+e.baseSysConf.mainPage,e.mainPageList=i,e.changeMainPageItem=function(n){angular.isUndefined(n)||(e.baseSysConf.mainPage=n)},e.changeMainPage=function(){a.sys.mainPage=e.baseSysConf.mainPage.replace(/^MainPage/,""),window.localStorage.setItem("pb.mainPage",e.baseSysConf.mainPage.replace(/^MainPage/,"")),l.success("applySuc")}}]).constant("MainPageList",["MainPageMenu","MainPageStatus"]).constant("ExpertItems",[{key:"0",text:"Disabled"},{key:"1",text:"Enabled"}])}.call(this),function(){"use strict";angular.module("pbApp").controller("LogController",["$scope","$http","$location","$sce","$timeout","Data","Dialog","Fn",function(e,n,t,a,o,i,r,s){var l,c;r.closeAll(),s.getLoginStatus()||(i.preSite=t.path(),t.path("/login")),c="/cgi-bin/luci/api/sys/syslog?"+s.getSearch(),s.partialLoadLang("setup"),e.loadSyslog=function(){return s.getLoginStatus()?void n.get(c).success(function(n){e.urlSyslog=c,angular.isUndefined(n)||(n=n.replace(/(([A-Z][a-z]{2}\s+){2}\d+\s+(\d{2}:){2}\d{2}\s+\d{4}\s)/g,function(e){return e="<br/><strong>"+e+"</strong><br/>"}),n=n.replace(/^<br\/>/i,""),e.syslog=a.trustAsHtml(n))}):r.reLogin(e.loadSyslog)},e.downloadSyslog=function(){return s.getLoginStatus()?void o(function(){return document.getElementById("syslog").click()},100):r.reLogin(e.downloadSyslog)},l="/cgi-bin/luci/api/sys/dmesg?"+s.getSearch(),e.loadDmesg=function(){return s.getLoginStatus()?void n.get(l).success(function(n){e.urlDmesg=l,angular.isUndefined(n)||(n=n.replace(/(\[\s*\d+\.\d+\])/g,function(e){return e="<br/><strong>"+e+"</strong><br/>"}),n=n.replace(/^<br\/>/i,""),e.dmesg=a.trustAsHtml(n))}):r.reLogin(e.loadDmesg)},e.downloadDmesg=function(){return s.getLoginStatus()?void o(function(){return document.getElementById("dmesg").click()},100):r.reLogin(e.downloadDmesg)}}])}.call(this),function(){"use strict";var e;e=angular.module("pbApp").controller("SecurityController",["$scope","$location","$timeout","Data","Dialog","Fn","Toast",function(e,n,t,a,o,i,r){o.closeAll(),i.getLoginStatus()||(a.preSite=n.path(),n.path("/login")),i.partialLoadLang("setup"),e.changePwd=function(){var n;return i.getLoginStatus()?!!i.checkParameter(e.old_passwd,{name:"Old Password"})&&(!!i.checkParameter(e.new_passwd,{name:"New Password"})&&(e.old_passwd===e.new_passwd?r.warn("samePwd"):(n=i.getSearch([{key:"old_passwd",value:e.old_passwd},{key:"new_passwd",value:e.new_passwd}]),o.applying(),void i.postJSON("/cgi-bin/luci/api/sys/password?"+n,function(n){o.close(),0===n.code?i.getTranslate("setupNewPWD",function(n){o.text(""+n+e.new_passwd),t(function(){return e.old_passwd="",e.new_passwd="",o.close()},2e3)}):(o.close(),console.warn(n),r.warn("errorPwd"))},function(){return t(function(){return o.close()},2e3)})))):o.reLogin(e.changePwd)}}])}.call(this),function(){"use strict";angular.module("pbApp").controller("SysController",["$scope","$http","$location","$window","$route","$timeout","Data","Dialog","Fn","Toast",function(e,n,t,a,o,i,r,s,l,c){var u,d,p;s.closeAll(),l.getLoginStatus()||(r.preSite=t.path(),t.path("/login")),l.partialLoadLang("setup"),u=function(){r={sys:{lang:"en_us"},user:{},wan:{},lan:{},wifi:[],adv:{}},window.localStorage.setItem("pb.startTime",-3600),window.localStorage.setItem("pb.user",null)},p=function(e){var n;n=!1,i(function(){var e;e=l.pingLB(function(){n&&(u(),l.clearPing(e),s.close(),a.location.href="http://192.168.1.1/")},function(){n=!0})},e)},e.themeEnabled=null!=(d=r.sys.isMultiThemes)&&d,e.changeTheme=function(){return l.getLoginStatus()?void l.getTranslate("geekMode",function(e){var n;confirm(e)&&(n=l.getSearch([{key:"change",value:1}]),l.postJSON("/cgi-bin/luci/lafite/change?"+n,function(){c.success("geekSuc"),a.location.href="http://"+t.host()}))}):s.reLogin(e.changeTheme)},e.resetSystem=function(){return l.getLoginStatus()?void l.getTranslate("setupRestore",function(e){var t;confirm(e)&&(s.text("restoring"),t=l.getSearch([{key:"reset",value:1}]),l.postJSON("/cgi-bin/luci/api/sys/sysreset?"+t,function(e){return 60005!==e.code?(c.warn(e.code_info),void s.close()):(c.success("setupRestoreSuc"),p(8e3))},function(){return n.get("/").success(function(){s.close()}).error(function(){p(8e3)})}))}):s.reLogin(e.resetSystem)},e.reboot=function(){l.getTranslate("setupReboot",function(e){confirm(e)&&l.postJSON("/cgi-bin/luci/api/sys/reboot?"+l.getSearch(),function(e){var n;60006===e.code&&(s.text("rebooting"),n=l.pingLB(function(){o.reload(),window.localStorage.setItem("pb.startTime",-3600),window.localStorage.setItem("pb.user",null),r.user={},l.clearPing(n),s.close()}))})})}}])}.call(this),function(){"use strict";angular.module("pbApp").controller("UpgradeController",["$scope","$http","$location","$sce","$interval","$timeout","$window","Data","Dialog","Fn","Toast",function(e,n,t,a,o,i,r,s,l,c,u){var d,p,f,g,m,w,h,v,y,_,b,k;l.closeAll(),c.getLoginStatus()||(s.preSite=t.path(),t.path("/login")),c.partialLoadLang("setup"),s.sys.versions&&(e.firmwareVersion=s.sys.versions.distVersion.replace(/^.*\.\d{2}\s/,"")),e.expertMode=s.sys.isExpert,e.isMobile=s.isMobile,f=function(e,n){var t;t=o(function(){var a,i;if(i=null,a=document.getElementsByName("_uploadFrm")[0].contentWindow.document.body,angular.isString(a.innerHTML)&&a.innerHTML.length>0&&a.getElementsByTagName("pre")&&(a=a.getElementsByTagName("pre")[0],angular.isString(a.innerHTML)&&a.innerHTML.length>0))return i=JSON.parse(a.innerHTML),0!==i.code?(a.innerHTML="",null!=n&&angular.isFunction(n)&&n(i)):(a.innerHTML="",null!=e&&angular.isFunction(e)&&e(i)),o.cancel(t)},50)},b=function(e,t,a){var o,r,s;a&&"function"==typeof a||(a=function(){return u.warn("Network_Timeout!")}),r=e,o=function(){return l.text("upgrading"),n.get("/cgi-bin/luci/api/sys/sysupdate?"+r).success(function(){s()}).error(function(){var e;e=c.pingLB(function(n){c.clearPing(e),null!=a&&angular.isFunction(a)&&a(n)},function(){c.clearPing(e),s()})})},s=function(){var e;e=!1,i(function(){var n;n=c.pingLB(function(a){if(e)return null!=t&&angular.isFunction(t)&&t(a),c.clearPing(n)},function(){e=!0})},3e3)},o()},_=function(e){b(e,function(){s={sys:{lang:"en_us"},user:{},wan:{},lan:{},wifi:[],adv:{}},window.localStorage.setItem("pb.startTime",-3600),window.localStorage.setItem("pb.user",null),l.close(),r.location.href="http://192.168.1.1"},function(){return l.close()})},e.uploadFirmware=function(){var n,t;n=document.getElementById("frmUpload"),n.action="/cgi-bin/luci/api/sys/upload?"+c.getSearch(),t=document.getElementById("image"),null==t.onchange&&(t.onchange=function(){var a;if(t.value&&t.value.length>0)return c.getLoginStatus()?(a=c.getSearch([{key:"keep",value:0}]),c.getTranslate("confirmSaveConfig",function(e){confirm(e)&&(a=c.getSearch([{key:"keep",value:1}]))}),c.getTranslate("confirmUpgrade",function(e){return confirm(e)?(n.submit(),l.text("uploading"),f(function(){t.value="",u.success("uploadSuc"),l.close(),_(a)},function(e){t.value="",u.warn(e.code_info),console.warn(e),l.close()}),void 0):void(t.value="")})):l.reLogin(e.uploadFirmware)}),null==n.onsubmit&&(n.onsubmit=function(){return!!(t.value&&t.value.length>0)||(t.click(),!1)})},g="check",y="upgrade",e.currentSize=-1,e.checking=!1,e.otaDisable=!1,e.updateEnable=!1,e.otaText=""+g,angular.isDefined(s.remote)?e.remote=s.remote:e.remote={},"0"===e.expertMode?e.releases=["stable"]:e.releases=["stable","dev","beta"],e.otaConf={type:e.releases[0]},k=!1,w=function(n,o,i){var r;return null==n&&(n="stable"),null==o&&(o=!1),k?void(e.otaDisable=!0):(r=[{key:"type",value:n}],o?r.push({key:"log",value:1}):(c.getTranslate("nowCheckingVersion",function(e){l.text(e)}),e.checking=!0),k=!k,void c.postJSON("/cgi-bin/luci/api/sys/remote?"+c.getSearch(r),function(o){if(k=!1,e.checking=!1,l.closeAll(),angular.isObject(o)){if(40003===o.code&&(e.remote[n]={raw:e.firmwareVersion}),40001===o.code)return void t.path("/exit");0===o.code&&o.content[0].length>0&&(e.remote=null!=s.remote?s.remote:s.remote={},angular.isString(o.content[0])?s.remote[n]=JSON.parse(o.content[0]):s.remote[n]=o.content[0],angular.isDefined(s.remote[n].size)&&(e.totalSize=s.remote[n].size),angular.isDefined(s.remote[n].content)&&(e.firmwareLogs=a.trustAsHtml(s.remote[n].content))),e.otaDisable=!1,0===o.code&&angular.isFunction(i)&&i()}},function(){u.warn("plsRetry"),k=!1,e.otaDisable=!1,e.checking=!1}))},m=function(){var n;return angular.isUndefined(e.totalSize)||e.totalSize<=0?void w(e.otaConf.type,!0,m):(n=p(),n<0?c.getTranslate("warnLowVersion",function(n){confirm(n)||(e.otaDisable=!1)}):c.getTranslate("confirmDownloadFrm",function(n){confirm(n)||(e.otaDisable=!1)}),e.otaConf.type!==e.releases[0]&&"0"===e.expertMode?(c.getTranslate("checkExpert",function(e){u.warn(e)}),void(e.otaDisable=!1)):(u.info("downloadingFrm"),void h()))},h=function(){var n;n=[{key:"type",value:e.otaConf.type}],c.postJSON("/cgi-bin/luci/api/sys/remote_firmware?"+c.getSearch(n),function(n){var t;if(angular.isObject(n)){if(angular.isString(n))try{n=JSON.parse(n)}catch(a){return t=a,void console.warn(t)}40003===n.code&&w(e.otaConf.type,!1,h)}},function(){u.warn("plsRetry"),e.otaDisable=!1}),i(d,500)},d=function(){var n,t;t=0,n=o(function(){return++t>60&&e.currentSize<=0?(o.cancel(n),t=0,e.otaDisable=!1,void u.warn("plsRetry")):void c.postJSON("/cgi-bin/luci/api/sys/upload_progress?"+c.getSearch(),function(t){0===t.code&&(t=t.content[0],e.currentSize=t.size,e.totalSize===e.currentSize&&(o.cancel(n),i(v,200)))},function(){u.warn("plsRetry"),e.otaDisable=!1})},1e3)},v=function(){var n;n=[{key:"type",value:e.otaConf.type}],c.getTranslate("confirmSaveConfig",function(t){n.push({key:"keep",value:confirm(t)?1:0}),c.getTranslate("confirmUpgrade",function(t){confirm(t)?_(c.getSearch(n)):e.otaDisable=!1})})},p=function(){var n;return angular.isUndefined(e.remote[e.otaConf.type])?(e.updateEnable=!1,void(e.otaText=""+g)):(n=e.remote[e.otaConf.type].raw.localeCompare(e.firmwareVersion),n>0?(e.updateEnable=!0,e.otaText=""+y,w(e.otaConf.type,!0,null)):(e.updateEnable=!1,e.otaText=""+g),n)},e.otaFrm=function(){if(p(),!e.otaDisable&&angular.isString(e.otaConf.type))return e.otaDisable=!0,e.updateEnable?void m():void w(e.otaConf.type,!1,p)},e.switchItem=function(n){angular.isString(n)&&n.length>0&&(e.otaConf.type=n,e.otaText=""+g,angular.isDefined(e.remote[n])&&p())}}])}.call(this),function(){"use strict";angular.module("pbApp").controller("StatusBandwidthController",["$scope","$location","$interval","Data","Fn","Dialog","DevicesMAC","Toast",function(e,n,t,a,o,i,r,s){var l,c,u,d,p,f,g,m,w,h,v,y,_,b,k,S;o.getLoginStatus()||(a.preSite=n.path(),n.path("/login")),o.partialLoadLang("status"),c=f=0,u=d=0,h=0,y=[],e.hostInfo=[],e.totalInfo={sdownload:0,supload:0,download:0,upload:0},e.statusExpert=!1,"1"===a.sys.isExpert&&(e.statusExpert=!0),k=function(n){var t,a,o,i,r,s,l,c;if(angular.isArray(n)){if(e.hostInfo.length<=0)return void(e.hostInfo=n);for(a=0,r=n.length;a<r;a++){for(o=n[a],l=!0,c=e.hostInfo,i=0,s=c.length;i<s;i++)if(t=c[i],o.mac===t.mac){t.upload=o.upload,t.download=o.download,t.upload_text=o.upload_text,t.download_text=o.download_text,l=!1;break}l&&e.hostInfo.push(o)}}},b=function(){e.hostInfo.length<=0||o.postJSON("/cgi-bin/luci/api/lan/clients",function(n){var t,a,o,i,s,l,c,u,d,p,f,g,m,w,h,v,y,_;if(n.code&&0!==n.code)return void console.warn(n.code_info);if(angular.isArray(n.content)&&!(n.content.length<=0)){for(h=n.content,s=0,f=h.length;s<f;s++)if(l=h[s],!angular.isUndefined(l.macaddr)&&!angular.isUndefined(l.hostname))for(v=e.hostInfo,c=0,g=v.length;c<g;c++)i=v[c],i.mac===l.macaddr.toUpperCase()&&null!=l.hostname&&(i.hostname=l.hostname.substr(0,16));for(y=e.hostInfo,u=0,m=y.length;u<m;u++)if(t=y[u],"unknownHost"===t.hostname)for(d in r){for(_=r[d],o=!1,p=0,w=_.length;p<w;p++)if(a=_[p],t.mac.startsWith(a)){t.hostname=d,o=!0;break}if(o)break}}})},p=function(){var n,t,a,o;if(angular.isArray(e.hostInfo))for(o=e.hostInfo,n=0,a=o.length;n<a;n++)t=o[n],t.upload=0,t.download=0},v=function(){o.postJSON("/cgi-bin/luci/api/bandwidth/ipbandwidth",function(e){w(e),S()})},w=function(n){var t,a,o,i,r,s,l,g,m,w,_,S,x,L,D,A,P,T;if(!angular.isUndefined(n)){if(n.code&&0!==n.code)return void console.warn(n.code_info);if(angular.isUndefined(n.content.data)||!angular.isArray(n.content.data))return void p();if(n.content.data.length<=0)return void p();if(y.length<=0)return y=n.content.data,void v();for(a=P=0,null!=(S=e.totalInfo)&&null==S.sdownload&&(S.sdownload=0),null!=(x=e.totalInfo)&&null==x.supload&&(x.supload=0),f=n.content.date,0===c&&(c=f),L=n.content.data,i=0,g=L.length;i<g;i++)r=L[i],angular.isUndefined(r.download)||angular.isUndefined(r.upload)||(a+=parseInt(r.download,10),P+=parseInt(r.upload,10));for(0===u&&(u=a),0===d&&(d=P),e.totalInfo.download=(a/1024).toFixed(2),e.totalInfo.upload=(P/1024).toFixed(2),t=function(e,n){return c===f?0:e===n?0:(e-n)/(f-c)},e.totalInfo.sdownload=t(a,u),e.totalInfo.supload=t(P,d),e.totalInfo.sdownload=(e.totalInfo.sdownload/1024).toFixed(2),e.totalInfo.supload=(e.totalInfo.supload/1024).toFixed(2),A=[],D=n.content.data,s=0,m=D.length;s<m;s++)if(r=D[s],!angular.isUndefined(r.download)&&!angular.isUndefined(r.upload))for(l=0,w=y.length;l<w;l++)if(_=y[l],r.mac===_.mac&&r.ip===_.ip){o=t(r.download,_.download),T=t(r.upload,_.upload),o=(o/1024).toFixed(2),T=(T/1024).toFixed(2),A.push({ip:r.ip,mac:r.mac.toUpperCase(),hostname:"unknownHost",download:o,upload:T,download_text:(r.download/1024).toFixed(2),upload_text:(r.upload/1024).toFixed(2)});break}k(A),h!==A.length&&(h=A.length,b()),c=f,u=a,d=P,y=n.content.data}},v(),l=o.ping("/cgi-bin/luci/api/bandwidth/ipbandwidth",function(e){/status/i.test(n.path())||o.clearPing(l),w(e)},function(){return o.clearPing(l)},2e3),g=[{key:"download_threshold",value:"qos_client_download_threshold"},{key:"upload_threshold",value:"qos_client_upload_threshold"},{key:"download",value:"qos_client_download"},{key:"upload",value:"qos_client_upload"},{key:"ports",value:""},{key:"comment",value:""},{key:"priority",value:""},{key:"wname",value:""},{key:"type",value:""}],m={macaddr:{mac:!0,readonly:!0},ipaddr:{ip:!0},start:{ip:!0},limit:{ip:!0},download_threshold:{"default":"0",ext:" KB",speed:!0},upload_threshold:{"default":"0",ext:" KB",speed:!0},download:{"default":"0",ext:" KB/s",speed:!0,Kb2KB:!0},upload:{"default":"0",ext:" KB/s",speed:!0,Kb2KB:!0},ports:{"default":"20,25,80,443,53",display:"none"},comment:{"default":"ftp,smtp,http,dns",display:"none"},priority:{"default":"3",display:"none"},wname:{optional:!0,display:"none"},type:{"default":"client",display:"none"}},_=[],S=function(){o.postJSON("/cgi-bin/luci/api/qos/status",function(n){var t,o,i,r,s,l,c,u,d,p,f,g;if(angular.isUndefined(n.code))return-1;if(40003===n.code)return a.adv.qos=[],0;if(0!==n.code)return console.warn(n.code_info),n.code;if(angular.isDefined(n.content)&&(a.adv.qos=n.content[0],angular.isDefined(a.adv.qos.clients))){for(f=a.adv.qos.clients.rang,o=0,c=f.length;o<c;o++)r=f[o],i=r.ipaddr.split("-"),r.start=i[0],r.limit=i[1];for(angular.isDefined(a.adv.qos.clients.mac)&&(_=a.adv.qos.clients.mac),g=e.hostInfo,s=0,u=g.length;s<u;s++)for(t=g[s],angular.isUndefined(t.hasQos)&&(t.hasQos=!1),l=0,d=_.length;l<d;l++)if(p=_[l],r.mac===p.mac){t.hasQos=!0;break}}})},e.qosMac=function(n){var t,a,r,l,c,u,d,p,f;if(!angular.isUndefined(n)){if(!o.getLoginStatus())return i.reLogin(function(){e.qosMac(n)});if(u=!0,S(),angular.isArray(_)){for(a=0,l=_.length;a<l;a++)if(p=_[a],n.mac===p.macaddr){c=p,u=!1;break}}else angular.isObject(_)&&n.mac===_.macaddr&&(c=_,u=!1);if(t={names:[{key:"macaddr",value:"qos_client_macaddr"}]},d={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/qos/setter",options:angular.copy(m),submitFn:function(e){0===e.code&&(s.success("QoS Modify Success!"),S())}},t.names=t.names.concat(g),u)t.title="addQosRegular",t.positivebtn="Add",d.options.macaddr["default"]=n.mac;else{t.title="updateQosRegular",t.positivebtn="Update";for(r in c)f=c[r],/\$/.test(r)||(d.options[r]["default"]=f)}t.negativebtn="Cancel",i.open(t,d)}},e.delQos=function(n){var t,a,r,l,c,u,d,p;if(!angular.isUndefined(n)){if(!o.getLoginStatus())return i.reLogin(function(){e.delQos(n)});if(n){for(S(),r=0,c=_.length;r<c;r++)if(d=_[r],d.macaddr===n.mac){a=d;break}if(!angular.isUndefined(a)){t={names:[{key:"macaddr",value:"qos_client_macaddr"},{key:"wname",value:""}],title:"delQosRegular",positivebtn:"Delete",negativebtn:"Cancel"},u={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/qos/delete",options:angular.copy(m),submitFn:function(e){0===e.code&&(s.success("Delete Success!"),S())}};for(l in a)p=a[l],/\$/.test(l)||(u.options[l]["default"]=p);i.open(t,u)}}}},i.closeAll()}])}.call(this),function(){"use strict";angular.module("pbApp").controller("StatusNetworkController",["$scope","$location","$interval","Data","WanProtos","Fn","Dialog","Toast",function(e,n,t,a,o,i,r,s){var l,c,u,d,p,f,g;return d=function(n){var t,a,i;if(e.statusWan=n,e.statusWan.sdownload="0.00",e.statusWan.supload="0.00",null!=e.statusWan)for(t=0,i=o.length;t<i;t++)a=o[t],e.statusWan.proto===a.key&&(e.statusWan.proto_text=a.value)},i.getLoginStatus()?(i.partialLoadLang("status"),e.statusWan=a.wan=null!=(u=a.wan)?u:{},d(a.wan),f=0,g=a.sys.lang.replace("_","-"),p=function(){var a;a=t(function(){var o,i,r;/status/i.test(n.path())||t.cancel(a),f>=0&&(o=Math.floor(f/3600/24),i=Math.floor(f/3600%24),r=Math.floor(f%3600/60),e.wanUpTime_text={dd:o,hh:i,mm:r},f+=1)},1e3)},l=t(function(){return i.postJSON("/cgi-bin/luci/api/wan/status?"+i.getSearch(),function(e){return e.code&&0!==e.code?void console.warn(e.code_info):(e=e.content[0],/status/i.test(n.path())||t.cancel(l),angular.copy(e,a.wan),d(e),angular.isDefined(e.status)&&e.status.uptime>0?(f=e.status.uptime,p(),t.cancel(l)):void 0)},function(){t.cancel(l),s.error("Network_Timeout!");
})},2e3),c=function(t){t.forEach(function(t){var a;a=i.ping("/cgi-bin/luci/api/bandwidth/devicebandwidth?device="+t.dev,function(o){var r,s,l,c,u,d,p,f;if(/status/i.test(n.path())||i.clearPing(a),o.code&&0!==o.code)return void console.warn(o.code_info);for(o=o.content,d=o.pop(),p=o.pop(),u=l=0,c=d.length;l<c;u=++l)r=d[u],d[u]-=p[u],d[u]<0&&(d[u]=-d[u]);f=(d[1]/d[0]/1024).toFixed(2),s=(d[3]/d[0]/1024).toFixed(2),e.speedData[t.key]={up:f,down:s}},function(){return i.clearPing(a)},5e3)})},e.dhcpNum=0,i.postJSON("/cgi-bin/luci/api/lan/clients",function(n){if(n.code){if(40003===n.code)return void(e.dhcpNum=0);if(0!==n.code)return void console.warn(n.code_info)}angular.isArray(n.content)&&(e.dhcpNum=n.content.length)},function(){return s.error("Network_Timeout!")}),void r.closeAll()):(a.preSite=n.path(),void n.path("/login"))}])}.call(this),function(){"use strict";angular.module("pbApp").controller("StatusStorageController",["$scope","$location","Data","Fn","Dialog",function(e,n,t,a,o){return a.getLoginStatus()?(a.partialLoadLang("status"),void o.closeAll()):(t.preSite=n.path(),void n.path("/login"))}])}.call(this),function(){"use strict";angular.module("pbApp").controller("StatusSummaryController",["$scope","$location","$interval","Data","WanProtos","WifiPower","Fn","Dialog","Toast",function(e,n,t,a,o,i,r,s,l){var c,u,d,p,f,g,m,w;r.getLoginStatus()||(a.preSite=n.path(),n.path("/login")),r.partialLoadLang("status"),p=function(n){var t,a,i;if(e.wanInfo=n,null!=e.wanInfo)for(t=0,i=o.length;t<i;t++)a=o[t],e.wanInfo.proto===a.key&&(e.wanInfo.proto_text=a.value)},f=function(n){var t,a,o,r,s,l,c,u,d,p,f,g,m,w,h,v;if(null!=e.wifiList&&0!==e.wifiList.length){for(m=e.wifiList,o=0,d=m.length;o<d;o++)for(r=m[o],s=0,p=n.length;s<p;s++)if(a=n[s],r.wname===a.wname)for(c in a)h=a[c],/^$/.test(c)||(r[c]=h)}else e.wifiList=n;if(e.wifiList)for(e.wifiClientsNum=0,w=e.wifiList,l=0,f=w.length;l<f;l++){for(v=w[l],u=0,g=i.length;u<g;u++)r=i[u],""+v.disabled===r.key&&(v.power_text=r.value);if(v.status)for(t in v.status.assoclist)++e.wifiClientsNum}},g=[],e.time_text={},w=a.sys.lang.replace("_","-"),m=function(n){if(!(n.length<=0))return n.forEach(function(n){var t,a,o;"sysDate"===n.key?(e.time_text[n.key]=n.value,n.value+=1):n.value>=0&&(t=Math.floor(n.value/3600/24),a=Math.floor(n.value/3600%24),o=Math.floor(n.value%3600/60),e.time_text[n.key]={dd:t,hh:a,mm:o},n.value+=1)})},d=function(){var e;e=t(function(){return/status/i.test(n.path())||t.cancel(e),m(g)},1e3)},e.wanInfo=a.wan=null!=(c=a.wan)?c:{},e.wifiList=a.wifi=null!=(u=a.wifi)?u:[],p(a.wan),f(a.wifi),r.postJSON("/cgi-bin/luci/api/wan/status?"+r.getSearch(),function(e){return e.code&&0!==e.code?void console.warn(e.code_info):(e=e.content[0],angular.copy(e,a.wan),p(e),angular.isDefined(e.status)&&e.status.uptime>0?g.push({key:"wanUpTime",value:e.status.uptime}):void 0)},function(){return l.error("Network_Timeout!")}),r.postJSON("/cgi-bin/luci/api/wifi/status?"+r.getSearch(),function(e){var n,t,o,i;if(e.code&&0!==e.code)return void console.warn(e.code_info);for(i=e.content,n=0,o=i.length;n<o;n++)t=i[n],null==t.disabled&&(t.disabled=0);a.wifi=e.content,f(e.content)},function(){return l.error("Network_Timeout!")}),e.assign_text=0,r.postJSON("/cgi-bin/luci/api/lan/clients",function(n){if(n.code){if(40003===n.code)return void(e.assign_text=0);if(0!==n.code)return void console.warn(n.code_info)}angular.isArray(n.content)&&(e.assign_text=n.content.length)},function(){return l.error("Network_Timeout!")}),r.postJSON("/cgi-bin/luci/api/sys/machine",function(e){return e.code&&0!==e.code?void console.warn(e.code_info):void(angular.isArray(e.content)&&(e=e.content[0],g.push({key:"runTime",value:e.time}),d()))},function(){return l.error("Network_Timeout!")}),s.closeAll()}]).constant("WifiPower",[{key:"0",value:"ON"},{key:"1",value:"OFF"}])}.call(this),function(){"use strict";angular.module("pbApp").controller("StatusSystemController",["$scope","$location","$interval","Data","Fn","Dialog","Toast",function(e,n,t,a,o,i,r){var s,l,c,u,d,p;o.getLoginStatus()||(a.preSite=n.path(),n.path("/login")),o.partialLoadLang("status"),d=[],e.time_text={},p=function(n){if(!(n.length<=0))return n.forEach(function(n){var t,a,o;"sysDate"===n.key?(e.time_text[n.key]=n.value,n.value+=1):n.value>=0&&(t=Math.floor(n.value/3600/24),a=Math.floor(n.value/3600%24),o=Math.floor(n.value%3600/60),e.time_text[n.key]={dd:t,hh:a,mm:o},n.value+=1)})},u=function(){var e;e=t(function(){return/status/i.test(n.path())||t.cancel(e),p(d)},1e3)},c=function(n){var t,o;angular.isDefined(n.cpuinfo)&&(e.cpuCore=parseInt(n.cpuinfo.num,10),a.statusSys.cpuCore=e.cpuCore,t=n.cpuinfo.loadavg,t.sort(function(e,n){return e-n}),o=t.shift(),0===o&&(o=t.shift()),o/=e.cpuCore,o>e.cpuCore?e.cpuUsage=(o/65535*100).toFixed(2)+"%":(o>1&&(o=1),e.cpuUsage=(100*o).toFixed(1)+"%"),a.statusSys.cpuUsage=e.cpuUsage),null!=n.mem&&(e.sysRAMUsage=(100-100*n.mem.memfree/n.mem.memtotal).toFixed(1)+"%",a.statusSys.sysRAMUsage=e.sysRAMUsage)},angular.isDefined(a.statusSys)?(angular.isDefined(a.statusSys.cpuCore)&&(e.cpuCore=a.statusSys.cpuCore),angular.isDefined(a.statusSys.cpuUsage)&&(e.cpuUsage=a.statusSys.cpuUsage),angular.isDefined(a.statusSys.sysProduct)&&(e.sysProduct=a.statusSys.sysProduct),angular.isDefined(a.statusSys.sysRAMUsage)&&(e.sysRAMUsage=a.statusSys.sysRAMUsage),angular.isDefined(a.statusSys.timeDiff)&&(l=((new Date).getTime()-a.statusSys.timeDiff)/1e3,l=Math.floor(l),d.push({key:"sysDate",value:l}),e.time_text.sysDate=l)):a.statusSys={},u(),o.postJSON("/cgi-bin/luci/api/sys/machine?"+o.getSearch(),function(n){var t;return t=(new Date).getTime(),n.code&&0!==n.code?void console.warn(n.code_info):angular.isArray(n.content)?(n=n.content[0],e.sysProduct=a.statusSys.sysProduct=n.model,c(n),d.pop(),d.push({key:"sysDate",value:n.date}),a.statusSys.timeDiff=t-1e3*n.date,d.push({key:"runTime",value:n.time})):void 0},function(){return r.error("Network_Timeout!")}),s=function(){var e;e=o.ping("/cgi-bin/luci/api/sys/machine?"+o.getSearch(),function(t){return/system/i.test(n.path())||o.clearPing(e),t.code&&0!==t.code?void console.warn(t.code_info):angular.isArray(t.content)?c(t.content[0]):void 0},function(){return o.clearPing(e)},5e3)},s(),i.closeAll()}])}.call(this),function(){"use strict";angular.module("pbApp").controller("SambaController",["$scope","$location","$route","Fn","Data","Dialog","Toast",function(e,n,t,a,o,i,r){a.getLoginStatus()||(o.preSite=n.path(),n.path("/login")),a.partialLoadLang("samba"),e.samba={};var s,l=function(){s=a.ping("/cgi-bin/luci/api/samba/status",function(t){if(!/samba/.test(n.url()))return a.clearPing(s,null);if(angular.isArray(t.content)&&!(t.content.length<1))for(var o in t.content){var i=t.content[o];angular.isArray(i.devices)?i.devices.length!==e.samba.devnum&&(e.samba.devnum=i.devices.length,e.samba.devices=i.devices,r.info("detectDev")):0!==e.samba.devnum&&(e.samba.devnum=0,e.samba.devices=i.devices,r.info("detectDev")),angular.isDefined(i.sub)&&angular.isArray(i.sub)&&(e.samba.sub=i.sub,e.samba.sub.forEach(function(e){e.users||(e.users="default"),e.read_only||(e.read_only="no"),e.create_mask||(e.create_mask="default"),e.dir_mask||(e.dir_mask="default")}))}},function(){a.clearPing(s,null),r.error("Network_Timeout!")},2e3)},c=function(){a.postJSON("/cgi-bin/luci/api/samba/status",function(n){if(!(void 0===typeof n.code||void 0===typeof n.content||0!==n.code||n.content.length<=0)){n=n.content[0],e.samba=n,"1"===o.sys.isExpert?e.samba.expert=!0:e.samba.expert=!1;var t=e.samba.option=["Disabled","Enabled"];void 0!==typeof e.samba.autoshare&&("1"===e.samba.autoshare?e.samba.autoshare_text=t[1]:"0"===e.samba.autoshare&&(e.samba.autoshare_text=t[0])),void 0!==typeof e.samba.homes&&("1"===e.samba.homes?e.samba.homes_text=t[1]:"0"===e.samba.homes&&(e.samba.homes_text=t[0])),e.samba.sub&&e.samba.sub.forEach(function(e){e.users||(e.users="default"),e.read_only||(e.read_only="no"),e.create_mask||(e.create_mask="default"),e.dir_mask||(e.dir_mask="default")}),e.samba.devnum=e.samba.devices.length||0,l(),i.closeAll()}},function(){r.error("Network_Timeout!"),i.closeAll()})};e.changeOption=function(n,t){if(!angular.isUndefined(t))return"auto"===n?void(e.samba.autoshare_text=t):void("home"===n&&(e.samba.homes_text=t))},e.sambaApply=function(){a.clearPing(s,null);var n=e.samba.option;e.samba.autoshare_text===n[1]?e.samba.autoshare=1:e.samba.autoshare_text===n[0]&&(e.samba.autoshare=0),e.samba.homes_text===n[1]?e.samba.homes=1:e.samba.homes_text===n[0]&&(e.samba.homes=0);var o=[{key:"type",value:"global"},{key:"wname",value:e.samba.wname},{key:"name",value:e.samba.name},{key:"description",value:e.samba.description},{key:"autoshare",value:e.samba.autoshare}];e.samba.expert&&(o.push({key:"workgroup",value:e.samba.workgroup}),o.push({key:"homes",value:e.samba.homes})),o=a.getSearch(o),i.applying();var l="/cgi-bin/luci/api/samba/setter?"+o;a.postJSON(l,function(e){0===e.code&&(c(),i.closeAll(),r.success("Update Success!"),t.reload())},function(){r.error("Network_Timeout!"),i.closeAll()})},e.updateDir=function(n){if(!a.getLoginStatus())return i.reLogin(function(){e.updateDir(n)});var t={names:[{key:"type",value:"type"},{key:"name",value:"sambaShareName"},{key:"path",value:"sambaPath"},{key:"guest_ok",value:"sambaAllowAny"},{key:"wname",value:""}],negativebtn:"Cancel"},o=[];if(!(e.samba.devnum>0))return r.warn("nodevice");e.samba.devices.forEach(function(e){o.push(e.mountpoint)});var s={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/samba/setter",options:{name:{checkFn:function(e){return!/[\\\/:\*\?"<>\|]/.test(e)&&!/^\s+/.test(e)||(r.warn("nospecailandblank"),!1)}},type:{"default":"sub",readonly:!0,display:"none"},path:{"default":o[0],readonly:!0,list:!0,items:o},guest_ok:{"default":"yes",list:!0,items:["yes","no"],Upper:!0},wname:{display:"none","default":"",optional:!1,readonly:!0}},submitFn:function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(n){return void console.warn(n)}return 0===e.code?(c(),r.success("Update Success!")):void r.warn("Modify Fail!")}};if(e.samba.expert&&(t.names=t.names.concat([{key:"users",value:"sambaAllowUser"},{key:"read_only",value:"sambaReadOnly"},{key:"create_mask",value:"sambaAllowWrite"},{key:"dir_mask",value:"sambaTree"}]),s.options.read_only={"default":"yes",list:!0,items:["yes","no"],Upper:!0},s.options.users={"default":"",readonly:!1,optional:!0},s.options.create_mask={"default":"",readonly:!1,optional:!0,checkFn:function(e){return!!/^[0-7]{3,4}$/.test(e)||(r.warn("nonumber"),!1)}},s.options.dir_mask={"default":"",readonly:!1,optional:!0,checkFn:function(e){return!!/^[0-7]{3,4}$/.test(e)||(r.warn("nonumber"),!1)}}),n){t.title="update_sharedir",t.positivebtn="Update";for(var l in n)/\$/.test(l)||("default"!==n[l]?s.options[l]={"default":n[l],readonly:!1}:s.options[l]={"default":"",readonly:!1,optional:!0});s.options.wname.optional=!1,s.options.wname.display="none"}else t.title="add_sharedir",t.positivebtn="Add",s.options.wname.optional=!0;i.open(t,s)},e.deleteDir=function(n){if(!a.getLoginStatus())return i.reLogin(function(){e.deleteDir(n)});if(!angular.isUndefined(n)){var t={title:"del_sharedir",names:[{key:"wname",value:"wname"},{key:"name",value:"sambaShareName"}],negativebtn:"Cancel",positivebtn:"delete"},o={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/samba/delete",options:{wname:{"default":n.wname,readonly:!0,display:"none"},name:{"default":n.name,readonly:!0}},submitFn:function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(n){return void console.warn(n)}return 0===e.code?(c(),r.success("Delete Success!")):void r.warn("Delete Fail!")}};i.open(t,o)}},c()}])}(),function(){"use strict";angular.module("pbApp").controller("FtpdController",["$scope","$location","Data","Dialog","Fn","Toast",function(e,n,t,a,o,i){var r,s,l;return o.getLoginStatus()?(o.partialLoadLang("ftpd"),angular.isDefined(t.ftpd)&&(e.ftpConf=t.ftpd),e.powerText=[{key:"1",value:"powerON"},{key:"0",value:"powerOFF"}],r=function(){var n;n=[{key:"enabled",value:e.ftpConf.enabled},{key:"anonymous_enable",value:e.ftpConf.anonymous_enable},{key:"write_enable",value:e.ftpConf.write_enable},{key:"ftpd_banner",value:e.ftpConf.ftpd_banner}],a.applying(),o.postJSON("/cgi-bin/luci/api/ftpd/setter?"+o.getSearch(n),function(e){0===e.code&&0===l(e)&&(i.success("Update Success!"),a.closeAll())},function(){i.error("Network_Timeout!"),a.closeAll()})},s=function(n){var t,a,o,i;if(!angular.isUndefined(n)){for(i=e.powerText,t=0,o=i.length;t<o;t++)if(a=i[t],n===a.key)return a.value;return n}},l=function(n){var t,a,o,i;if(0===n.code&&angular.isDefined(n.content)){for(i=n.content,t=0,o=i.length;t<o;t++)a=i[t],a.write_enable_text=s(a.write_enable),a.enabled_text=s(a.enabled),a.anonymous_enable_text=s(a.anonymous_enable),e.ftpConf=a;return 0}return-1},o.postJSON("/cgi-bin/luci/api/ftpd/status",function(e){l(e)}),e.ftpApply=function(){return o.getLoginStatus()?void r():a.reLogin(e.ftpApply)},void(e.changeOption=function(n,t){var a,o,i,r,s;if(!angular.isUndefined(n)&&!angular.isUndefined(t)){for(r=e.powerText,a=0,o=r.length;a<o;a++)s=r[a],t===s.value&&(i=s.key);switch(n){case"write":e.ftpConf.write_enable=i,e.ftpConf.write_enable_text=t;break;case"enabled":e.ftpConf.enabled=i,e.ftpConf.enabled_text=t;break;case"anonymous":e.ftpConf.anonymous_enable=i,e.ftpConf.anonymous_enable_text=t}}})):(t.preSite=n.path(),void n.path("/login"))}])}.call(this),function(){"use strict";angular.module("pbApp").controller("WifiRepeaterController",["$scope","$location","$timeout","Dialog","Data","Fn","Toast",function(e,n,t,a,o,i,r){var s,l,c,u,d;i.getLoginStatus()||(o.preSite=n.path(),n.path("/login")),i.partialLoadLang("wifi"),d=!1,"1"===o.sys.isExpert&&(d=!0),null==e.scanInfo&&(e.scanInfo=[]),null==e.wifiExpert&&(e.wifiExpert=d),s=[{key:"none",value:"wifi_encryption_none"},{key:"psk+psk2",value:"wifi_encryption_psk+psk2"},{key:"psk2",value:"wifi_encryption_psk2"}],null==e.wifiJoin&&(e.wifiJoin=[]),u=function(n){var t,a,o,i,r,l;if(n.code&&0!==n.code)return console.warn(n.code_info),n.code;for(0!==n.content.length&&(e.joinStatus=!0),l=n.content,o=0,r=l.length;o<r;o++)if(i=l[o],i.encryption)for(t in s)if(a=s[t],a.key===i.encryption){i.encryption_text=a.value;break}return e.wifiJoin=n.content,n.code},l=function(n){null==n&&(n=0),angular.isUndefined(n)&&(n=0),e.wifiJoin=[],i.postJSON("/cgi-bin/luci/api/wifi/join/status?"+i.getSearch(),function(e){a.closeAll(),0===e.code&&u(e)},function(){return n<3?l(n+1):(a.closeAll(),void r.error("Network_Timeout!"))})},a.loading(),l(0),c=function(n){var a,o;!angular.isArray(n)||n.length<=0||(o=n.pop(),a=[{key:"device",value:o}],i.postJSON("/cgi-bin/luci/api/wifi/scan?"+i.getSearch(a),function(a){var i,r,s,u,d,p,f,g;if(0===a.code){for(p=a.content,i=0,u=p.length;i<u;i++)g=p[i],g.device=o;for(f=a.content,s=0,d=f.length;s<d;s++)r=f[s],(angular.isUndefined(r.ssid)||0===r.ssid.length)&&(r.ssid=r.bssid);0===e.scanInfo.length?e.scanInfo=a.content:e.scanInfo=a.content.concat(e.scanInfo)}n.length<=0?l(0):t(function(){c(n)},200)},function(){n.length<=0?l(0):c(n)}))},e.scanWifi=function(){var n,s,l,u,d;if(e.scanInfo=[],i.getTranslate("scanningWifi",function(e){a.text(e)}),n=[],angular.isArray(o.wifi)&&o.wifi.length>0){for(d=o.wifi,s=0,u=d.length;s<u;s++)l=d[s],n.push(l.device);if(n.length>0)return void c(n)}n.length<=0&&i.postJSON("/cgi-bin/luci/api/wifi/status?"+i.getSearch(),function(e){var a,o,i;if(0===e.code){for(i=e.content,a=0,o=i.length;a<o;a++)l=i[a],n.push(l.device);t(function(){c(n)},200)}},function(){a.closeAll(),r.error("Network_Timeout!")})},e.joinWifi=function(n){var t,o;return i.getLoginStatus()?void(angular.isUndefined(n)||(t={names:[{key:"ssid",value:"wifi_ssid"},{key:"bssid",value:"wifi_bssid"},{key:"device",value:"device"},{key:"channel",value:"wifi_channel"},{key:"encryption",value:"wifi_encryption"},{key:"key",value:"wifi_password"}],title:"repeater_add",positivebtn:"Add",negativebtn:"Cancel"},o={dialogType:"form",cancel:!0,url:"/cgi-bin/luci/api/wifi/join",options:{ssid:{"default":n.ssid,readonly:!0,optional:!0},bssid:{"default":n.bssid,readonly:!0},device:{"default":n.device,display:"none",readonly:!0},channel:{"default":n.channel,readonly:!0},encryption:{readonly:!0},key:{readonly:!1}},submitFn:function(e){0===e.code&&(r.success("Add Success!"),l(0))}},n.encryption.enabled?(o.options.key.optional=!1,1===n.encryption.wep?(o.options.encryption["default"]="wep-open",o.options.key["default"]="1"):n.encryption.wpa>=2?o.options.encryption["default"]="psk2":o.options.encryption["default"]="psk"):(o.options.key.optional=!0,o.options.key.display="none",o.options.encryption["default"]="none"),d||(o.options.bssid.display="none",o.options.channel.display="none"),a.open(t,o))):a.reLogin(function(){e.joinWifi()})},e.disConn=function(){i.postJSON("/cgi-bin/luci/api/wifi/join/power?"+i.getSearch(),function(){l(0)})}}])}.call(this),function(){"use strict";angular.module("pbApp").constant("WifiEncryptions",[{key:"none",value:"wifi_encryption_none"},{key:"psk+psk2",value:"wifi_encryption_psk+psk2"},{key:"psk2",value:"wifi_encryption_psk2"}]).controller("WifiController",["$scope","$location","$timeout","Data","WifiEncryptions","Fn","Toast","Dialog",function(e,n,t,a,o,i,r,s){var l,c,u,d,p,f,g,m,w;i.getLoginStatus()||(a.preSite=n.path(),n.path("/login")),i.partialLoadLang("wifi"),e.wifi=[],d=function(e){null==e&&(e=0),i.postJSON("/cgi-bin/luci/api/wifi/status?"+i.getSearch(),function(e){0===g(e)&&s.closeAll()},function(){return e<3?d(e+1):void r.error("Network_Timeout!")})},g=function(n){var t;if(n.code&&0!==n.code)return console.warn(n.code_info),s.close(),n.code;if(!angular.isUndefined(n.content))return angular.isArray(n.content)&&n.content.length<=0?void r.error("NotFoundWifi"):(t=n.content,i.getTranslate("Channel",function(n){var o,i,r,s,l,c,d,f,g,h;for(o=n,l=0,d=t.length;l<d;l++)if(s=t[l],angular.isUndefined(s.disabled)&&(s.disabled="0"),null!=s.noscan&&p(s,s.noscan),null!=s.txpower&&m(s,s.txpower),null!=s.encryption&&u(s,s.encryption),null!=s.channel&&(/auto/i.test(s.channel)?s.channel_text="auto":s.channel_text=""+o+s.channel),angular.isArray(s.freqlist))for(g=s.freqlist,c=0,f=g.length;c<f;c++)i=g[c],angular.isDefined(i.channel)&&(h=i.channel.split(" "),i.channel_text={freq:h.pop()});for(angular.copy(t,a.wifi),angular.copy(t,e.wifi),r=0;r<e.wifi.length;)e.$watch("wifi["+r+"].disabled",w),++r}),n.code)},angular.copy(a.wifi,e.wifi),s.loading(),d(0),e.btnShow=!1,w=function(){var n,t,a,o;for(e.btnShow=!1,o=e.wifi,t=0,a=o.length;t<a;t++)if(n=o[t],"1"!==n.disabled)return void(e.btnShow=!0)},e.encryptions=o,u=e.encryption_change=function(n,t){var a,o,i,r;if(angular.isString(t)){for(r=e.encryptions,o=0,i=r.length;o<i;o++)a=r[o],a.key===t&&(n.encryption=a.key,n.encryption_text=a.value);return void(n.encryption||(n.encryption=e.encryptions[0].key,n.encryption_text=e.encryptions[0].value))}angular.isDefined(t.key)&&(n.encryption=t.key),angular.isDefined(t.value)&&(n.encryption_text=t.value)},l=e.channel_change=function(e,n){var t;return angular.isString(n)?void(/auto/i.test(n)?(e.channel_text="auto",e.channel="auto"):(i.getTranslate("Channel",function(t){e.channel_text=""+t+n}),e.channel=n)):void(angular.isDefined(n.channel)&&(i.getTranslate("Channel",function(t){var a;a=n.channel.split(" "),e.channel_text=t+" "+a.pop()}),t=n.channel.lastIndexOf(" "),e.channel=n.channel.slice(++t)))},e.noscan=[{key:"wifi_noscan_1",value:"1"},{key:"wifi_noscan_0",value:"0"}],p=e.noscanChange=function(n,t){var a,o,i,r;if(!angular.isUndefined(t)){if(!n.noscan_text)for(r=e.noscan,o=0,i=r.length;o<i;o++)a=r[o],a.value===t&&(n.noscan_text=a.key);n.noscan_text=t.key,n.noscan=t.value}},e.txpower=[{key:"save",value:"50"},{key:"normal",value:"80"},{key:"performance",value:"100"}],m=e.txpowerChange=function(n,t){var a,o,i,r;if(!angular.isUndefined(t))if(n.txpower_text)n.txpower_text=t.key,n.txpower=t.value;else for(i=e.txpower,a=0,o=i.length;a<o;a++)r=i[a],r.value===t&&(n.txpower_text=r.key)},e.setWifi=function(){var n;return i.getLoginStatus()?(n=function(n){var t,a,o,r,l,u,d,p,g,m,w,h,v,y;for(t=0,y="/cgi-bin/luci/api/wifi/setter?",w=[],r=n.reconnetWifi,h=e.wifi,l=d=0,g=h.length;d<g;l=++d)u=h[l],angular.isString(u.ssid)&&u.ssid.length>0&&(r+=n.wifi_ssid+": "+u.ssid,"none"!==u.encryption&&angular.isString(u.key)&&u.key.length>0&&(r+=n.wifi_password+": "+u.key)),a=f(u),angular.isArray(a)&&a.length<=0||w.push(i.getSearch(a));for(p=0,m=w.length;p<m;p++)v=w[p],++t===w.length&&(v+="&finish=1",s.text(r)),o=1e3*(t-1),c(""+y+v,o)},void i.getTranslate(["reconnetWifi","wifi_ssid","wifi_password"],n)):s.reLogin(e.setWifi)},c=function(e,n){t(function(){i.postJSON(e,function(n){0===n.code&&/finish/i.test(e)&&0===g(n)&&(r.success("wirelessSuc"),t(s.closeAll,5e3))},function(){r.error("Network_Timeout!"),s.closeAll()})},n)},f=function(e){var n,t,o,r,s;if("0"!==e.disabled)return[];if(!i.checkParameter(e.ssid,{name:"SSID"}))return[];if(!i.checkParameter(e.encryption,{name:"Encryption Type"}))return[];if("none"!==e.encryption&&!i.checkParameter(e.key,{minLen:8}))return[];if(!i.checkParameter(e.channel,{name:"Channel"}))return[];for(n=[{key:"wname",value:e.wname}],s=a.wifi,o=0,r=s.length;o<r;o++)t=s[o],e.device===t.device&&(e.ssid!==t.ssid&&n.push({key:"ssid",value:e.ssid}),e.channel!==t.channel&&n.push({key:"channel",value:e.channel}),"none"===t.encryption?"none"!==e.encryption&&(n=n.concat([{key:"encryption",value:e.encryption},{key:"key",value:e.key}])):"none"===e.encryption?n.push({key:"encryption",value:e.encryption}):e.encryption===t.encryption&&e.key===t.key||(n=n.concat([{key:"encryption",value:e.encryption},{key:"key",value:e.key}])),null!=e.txpower&&e.txpower!==t.txpower&&n.push({key:"txpower",value:e.txpower}),null!=e.noscan&&e.noscan!==t.noscan&&n.push({key:"noscan",value:e.noscan}));return n.length<=1?[]:n}}])}.call(this);