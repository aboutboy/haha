(function(){"use strict";var t;t=angular.module("pandorabox.pages"),t.register.controller("RStorageOverviewController",["$scope","$interval","$UCI","Status",function(t,n,e,i){var r,a,o,s,c,u,l,f;return null==i.storagelist&&(i.storagelist={deviceList:[]}),r=[],t.deviceList=null!=(u=i.storagelist.deviceList)?u:[],c=!1,(f=function(){if(!c)return c=!0,e.$sync("samba").then(function(t){var n,e;r=function(){var i,r;i=t.samba,r=[];for(n in i)e=i[n],"sambashare"===e[".type"]&&r.push({name:e.name,path:e.path});return r}()}).then(function(){c=!1}).then(function(){0!==r.length?l():i.storagelist.deviceList=t.deviceList=[]})})(),o=n(function(){c||f()},2e3),s=!1,l=function(){if(!s)return s=!0,e.$command(r.map(function(t){return"GET df -h "+t.path}),"now").then(function(n){var e,a,o,s,c,u,l,f,h,v,g,d,p,m;for(a={},g=n.commands,c=0,f=g.length;c<f;c++)u=g[c],1!==u.content.length&&(o=u.content[1].split(/\s+/),l=o.length-5,p=o[l++],m=o[l++],s=o[l++],h=o[l++],v=o[l++],/mnt/.test(v)&&(a[v]={size:p,used:m,availabel:s,path:v,p:h,name:null!=(d=function(){var t,n,e;for(e=[],t=0,n=r.length;t<n;t++)u=r[t],u.path===v&&e.push(u.name);return e}()[0])?d:null}));i.storagelist.deviceList=t.deviceList=function(){var t;t=[];for(e in a)u=a[e],t.push(u);return t}()}).then(function(){s=!1})},a=n(function(){return 0===r.length?void(i.storagelist.deviceList=t.deviceList=[]):void(s||l())},5e3),t.$root.$on("page.main.current",function(t,e){"rstorage"!==e&&(n.cancel(o),n.cancel(a))})}])}).call(this);