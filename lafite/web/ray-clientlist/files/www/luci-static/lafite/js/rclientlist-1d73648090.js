(function(){"use strict";var t;t=angular.module("pandorabox.pages"),t.register.controller("RClientListController",["$scope","$q","$timeout","PBClientList","Fn","$UCI","FloatDiv","Status",function(t,e,n,i,a,d,s,r){var l,o;t.wiredList=[],t.wirelessList=[],i.init(),(o=function(){var e,n;if(e=function(){var e,i,a,d;for(a=t.wiredList,d=[],e=0,i=a.length;e<i;e++)n=a[e],n.edit&&d.push(n.edit);return d}().length>0,e||(t.wiredList=i.getList({port:!0,dhcp:!0})),e=function(){var e,i,a,d;for(a=t.wirelessList,d=[],e=0,i=a.length;e<i;e++)n=a[e],n.edit&&d.push(n.edit);return d}().length>0,!e)return t.wirelessList=i.getList({wireless:!0,dhcp:!0})})(),t.isExistQos=!1,t.bandwidth={enabled:"0",upload:0,download:0},t.bandwidthTestFlag=!1,t.startBandwidthTest=function(){t.bandwidth.up=0,t.bandwidth.down=0,t.bandwidthTestFlag=!0},t.endBandwidthTest=function(){t.bandwidth.up=0,t.bandwidth.down=0,t.bandwidthTestFlag=!1},t.saveQos=function(){var e;return!(+t.bandwidth.upload<0)&&(!(+t.bandwidth.download<0)&&(e=s.once(),d.$set("bandwidth","main",{enabled:t.bandwidth.enabled?"1":"0",upload:t.bandwidth.upload,download:t.bandwidth.download}),e(),!0))},t.blackList=[],l=function(){var e,n,i,a,s;if(null==d.wireless)return!1;t.blackList=[],i=d.wireless,a=[];for(n in i)e=i[n],/^cfg/.test(n)&&null==e.ifname&&"sta"!==e.mode&&(t.blackList=t.blackList.concat(function(){var t,i,a,r,l;for(r=null!=(a=e.maclist)?a:[],l=[],t=0,i=r.length;t<i;t++)s=r[t],l.push({macaddr:s,section:n,device:e.device,hwmode:d.wireless[e.device].hwmode});return l}()));return a},t.addBlackList=function(t){var e,n,i,a,r,o,u,c,w,h;if(t.guest)return!1;for(h=function(){var n,i;n=d.$Native.wireless,i=[];for(r in n)e=n[r],/^cfg/.test(r)&&null==e.ifname&&e.device===t.device&&"sta"!==e.mode&&i.push(r);return i}(),n=d.$getAutoSave(),d.$setAutoSave(!1),a=0,o=h.length;a<o;a++)w=h[a],u=null!=(c=d.$Native.wireless[w].maclist)?c:[],-1===u.indexOf(w)&&(u.push(t.macaddr),d.$set("wireless",w,{macpolicy:"deny",maclist:u}));return i=s.once(),n?d.$save("wireless").then(function(){return l()}).then(function(){return d.$setAutoSave(n),i()}):i(),!0},t.removeBlackList=function(t){var e,n,i;return e=d.$getAutoSave(),d.$setAutoSave(!1),i=angular.copy(d.wireless[t.section].maclist),i.splice(i.indexOf(t.macaddr),1),0!==i.length?d.$set("wireless",t.section,{macpolicy:"deny",maclist:i}):d.$set("wireless",t.section,{maclist__del:i}),n=s.once(),e?d.$save("wireless").then(function(){return l()}).then(function(){return n(),d.$setAutoSave(e)}):n(),!0},t.editName=function(t){return t.edit=!0,function(t){return n(function(){return document.getElementById(t.macaddr).focus()},200)}(t),!0},t.editNameExit=function(t){return i.setClientName(t.macaddr,t.hostname)["finally"](function(){return t.edit=!1})},function(){var e;return e=function(){return null==d.bandwidth?(t.isExistQos=!1,!1):null==d.bandwidth.main?(t.isExistQos=!1,!1):(t.isExistQos=!0,t.bandwidth=angular.copy(d.bandwidth.main),"1"===t.bandwidth.enabled?t.bandwidth.enabled=!0:t.bandwidth.enabled=!1,!0)},null!=d.bandwidth&&e(),d.$sync(["bandwidth"]).then(e),t.$on("PBClientListUpdate",function(){return l(),o()})}()}])}).call(this);